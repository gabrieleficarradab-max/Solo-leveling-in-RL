<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Life Leveling - Complete Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 2px solid rgba(106, 90, 205, 0.3);
        }

        h1 {
            color: #ffd700;
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .player-card {
            background: linear-gradient(135deg, rgba(106, 90, 205, 0.2), rgba(72, 61, 139, 0.2));
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid rgba(138, 43, 226, 0.5);
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
        }

        .player-name {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .rank {
            display: inline-block;
            padding: 5px 15px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 15px;
            margin-right: 10px;
        }

        .rank.S { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; }
        .rank.A { background: linear-gradient(135deg, #ff6b6b, #ee5a6f); }
        .rank.B { background: linear-gradient(135deg, #4ecdc4, #44a08d); }
        .rank.C { background: linear-gradient(135deg, #95e1d3, #76c7c0); }
        .rank.D { background: linear-gradient(135deg, #a8dadc, #457b9d); }
        .rank.E { background: linear-gradient(135deg, #6c757d, #495057); }
        .rank.NATIONAL { background: linear-gradient(135deg, #ff00ff, #8b00ff); color: #fff; animation: pulse 2s infinite; }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 0, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 0, 255, 1); }
        }

        .job-class {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(138, 43, 226, 0.3);
            border-radius: 20px;
            font-size: 12px;
            border: 1px solid rgba(138, 43, 226, 0.5);
        }

        .level {
            font-size: 20px;
            margin-bottom: 10px;
        }

        .stat-bar {
            margin: 10px 0;
        }

        .stat-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6a5acd, #8a2be2);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .hp-bar .progress-fill { background: linear-gradient(90deg, #ff6b6b, #ee5a6f); }
        .mp-bar .progress-fill { background: linear-gradient(90deg, #4ecdc4, #44a08d); }

        .hp-warning { background: linear-gradient(90deg, #ff9500, #ff6b00) !important; animation: blink 1s infinite; }
        .hp-critical { background: linear-gradient(90deg, #ff0000, #cc0000) !important; animation: blink 0.5s infinite; }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .stat-name {
            font-size: 12px;
            color: #bbb;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-exp-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .stat-exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            transition: width 0.3s ease;
        }

        .stat-exp-label {
            font-size: 10px;
            color: #999;
            margin-top: 3px;
            text-align: center;
        }

        .stat-points {
            background: rgba(255, 215, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .stat-exp-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }

        .stat-exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            transition: width 0.3s ease;
        }

        .stat-exp-label {
            font-size: 10px;
            color: #999;
            margin-top: 3px;
            text-align: center;
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid rgba(106, 90, 205, 0.3);
        }

        .section-title {
            font-size: 20px;
            color: #ffd700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quest-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #6a5acd;
            transition: all 0.3s;
        }

        .quest-item:hover {
            background: rgba(0, 0, 0, 0.5);
            transform: translateX(5px);
        }

        .quest-item.completed {
            opacity: 0.6;
            border-left-color: #4ecdc4;
        }

        .quest-item.emergency {
            border-left: 4px solid #ff0000;
            background: linear-gradient(90deg, rgba(255, 0, 0, 0.1), rgba(0, 0, 0, 0.3));
            animation: emergencyPulse 2s infinite;
        }

        .quest-item.boss {
            border-left: 4px solid #8b00ff;
            background: linear-gradient(90deg, rgba(139, 0, 255, 0.1), rgba(0, 0, 0, 0.3));
        }

        @keyframes emergencyPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 0, 0, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 0, 0, 0.8); }
        }

        .quest-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .quest-title {
            font-weight: bold;
            font-size: 16px;
        }

        .quest-reward {
            background: rgba(255, 215, 0, 0.2);
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            color: #ffd700;
        }

        .quest-description {
            font-size: 14px;
            color: #bbb;
            margin-bottom: 10px;
        }

        .quest-timer {
            font-size: 12px;
            color: #ff6b6b;
            margin-bottom: 10px;
        }

        .complete-btn {
            background: linear-gradient(135deg, #6a5acd, #8a2be2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s;
        }

        .complete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
        }

        .complete-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #6a5acd, #8a2be2);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.emergency {
            background: linear-gradient(135deg, #ff0000, #cc0000);
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(5px) rotate(2deg); }
            75% { transform: translateX(-5px) rotate(-2deg); }
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .inventory-slot {
            aspect-ratio: 1;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(106, 90, 205, 0.3);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .inventory-slot:hover {
            border-color: rgba(138, 43, 226, 0.8);
            background: rgba(138, 43, 226, 0.2);
        }

        .inventory-slot.has-effect {
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .item-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }

        .item-count {
            font-size: 12px;
            color: #ffd700;
        }

        .item-effect {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            background: rgba(255, 215, 0, 0.3);
            padding: 2px 5px;
            border-radius: 5px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.95);
            border-top: 2px solid rgba(106, 90, 205, 0.3);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            transition: all 0.3s;
        }

        .nav-btn.active {
            color: #ffd700;
        }

        .nav-icon {
            font-size: 24px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .penalty-warning {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid #ff6b6b;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
        }

        .reset-btn {
            background: rgba(255, 107, 107, 0.3);
            border: 1px solid #ff6b6b;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            width: 100%;
            border: 2px solid rgba(106, 90, 205, 0.5);
            max-height: 80vh;
            overflow-y: auto;
        }

        .shadow-army-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .shadow-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #8a2be2;
        }

        .shadow-item .shadow-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .shadow-item .shadow-streak {
            font-size: 12px;
            color: #4ecdc4;
        }

        .shadow-item .shadow-bonus {
            font-size: 12px;
            color: #aaa;
            margin-top: 5px;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .achievement-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid rgba(106, 90, 205, 0.3);
        }

        .achievement-item.unlocked {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .achievement-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }

        .achievement-title {
            font-size: 12px;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .achievement-desc {
            font-size: 10px;
            color: #999;
        }

        .skill-tree {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .skill-branch {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
        }

        .skill-branch-title {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .skill-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .skill-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid #6a5acd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .skill-item:hover {
            background: rgba(106, 90, 205, 0.2);
        }

        .skill-item.unlocked {
            border-left-color: #4ecdc4;
            background: rgba(76, 205, 196, 0.1);
        }

        .skill-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .skill-name {
            font-weight: bold;
            font-size: 14px;
        }

        .skill-desc {
            font-size: 12px;
            color: #bbb;
            margin-top: 5px;
        }

        .skill-cost {
            font-size: 11px;
            color: #ffd700;
            margin-top: 5px;
        }

        .radar-chart-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .death-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #000;
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #ff0000;
        }

        .death-screen.active {
            display: flex;
        }

        .death-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ff0000;
            animation: deathPulse 2s infinite;
        }

        @keyframes deathPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .death-timer {
            font-size: 36px;
            margin-bottom: 20px;
        }

        .death-message {
            font-size: 18px;
            text-align: center;
            color: #999;
            max-width: 400px;
            line-height: 1.6;
        }

        .crafting-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .recipe-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(106, 90, 205, 0.3);
        }

        .recipe-item.unlocked {
            border-color: #4ecdc4;
        }

        .recipe-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .recipe-materials {
            font-size: 12px;
            color: #bbb;
            margin-bottom: 10px;
        }

        .craft-btn {
            background: linear-gradient(135deg, #6a5acd, #8a2be2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            width: 100%;
        }

        .craft-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status-effects {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }

        .status-effect {
            background: rgba(76, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 11px;
        }

        .status-effect.buff {
            background: rgba(76, 205, 196, 0.2);
            border-color: #4ecdc4;
        }

        .status-effect.debuff {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff6b6b;
        }

        /* Welcome Screen Styles */
        #welcomeScreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0a0a1e 0%, #16213e 100%);
            z-index: 10000;
            overflow-y: auto;
            padding: 20px;
        }

        .welcome-container {
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: 40px;
        }

        .welcome-title {
            text-align: center;
            font-size: 32px;
            color: #ffd700;
            margin: 40px 0 30px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .quote-box {
            background: rgba(255, 215, 0, 0.1);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .quote-text {
            font-size: 18px;
            line-height: 1.6;
            color: #ffd700;
            font-style: italic;
            margin-bottom: 15px;
        }

        .quote-author {
            font-size: 14px;
            color: #bbb;
        }

        .tutorial-section {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(106, 90, 205, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .tutorial-title {
            font-size: 24px;
            color: #ffd700;
            margin-bottom: 20px;
            text-align: center;
        }

        .tutorial-item {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border-left: 4px solid #6a5acd;
        }

        .tutorial-item-title {
            font-size: 16px;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 8px;
        }

        .tutorial-item-desc {
            font-size: 14px;
            color: #bbb;
            line-height: 1.5;
        }

        .continue-btn {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 40px auto;
            padding: 20px;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .continue-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.6);
        }

        .daily-quote {
            font-style: italic;
            color: #ffd700;
            font-size: 14px;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 8px;
        }

        .streak-display {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 0, 0, 0.2));
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 2px solid rgba(255, 107, 107, 0.5);
        }

        .streak-number {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            margin: 10px 0;
        }

        .streak-bonus {
            font-size: 12px;
            color: #4ecdc4;
        }

        .comparison-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .comparison-title {
            font-size: 18px;
            color: #ffd700;
            text-align: center;
            margin-bottom: 15px;
        }

        .comparison-row {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        .comparison-label {
            color: #bbb;
        }

        .comparison-values {
            display: flex;
            gap: 20px;
        }

        .comparison-old {
            color: #999;
        }

        .comparison-new {
            font-weight: bold;
        }

        .comparison-new.winning {
            color: #4ecdc4;
        }

        .comparison-new.losing {
            color: #ff6b6b;
        }
    </style>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-46MVKW4MNQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-46MVKW4MNQ');
    </script>
</head>
<body>
    <!-- Welcome Screen -->
    <div id="welcomeScreen" style="display: none;">
        <div class="welcome-container">
            <div class="welcome-title">‚öîÔ∏è REAL LIFE LEVELING ‚öîÔ∏è</div>
            
            <div class="quote-box">
                <div class="quote-text">
                    "√à meglio essere temuto che amato, se non si pu√≤ essere entrambi. 
                    Chi controlla s√© stesso, controlla il proprio destino."
                </div>
                <div class="quote-author">‚Äî Niccol√≤ Machiavelli</div>
            </div>

            <div class="tutorial-section">
                <div class="tutorial-title">üìñ COME FUNZIONA</div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">‚ù§Ô∏è HP (Punti Vita)</div>
                    <div class="tutorial-item-desc">
                        La tua vitalit√†. 0 HP = morte = 24h blocco. Perdi HP fallendo quest accettate.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">üíô MP (Punti Mana)</div>
                    <div class="tutorial-item-desc">
                        Energia per abilit√† speciali. Cresce con Intelligenza.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">‚≠ê EXP (Esperienza)</div>
                    <div class="tutorial-item-desc">
                        Completa quest per salire di livello e diventare pi√π forte.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">üìã QUEST</div>
                    <div class="tutorial-item-desc">
                        Devi ACCETTARE una quest per iniziare il timer. Completa prima della scadenza o subisci penalit√† HP.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">üí™ STATISTICHE</div>
                    <div class="tutorial-item-desc">
                        Crescono automaticamente completando quest. Barra EXP sotto ogni stat. 100 EXP ‚Üí +1 stat.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">üí∞ MANA STONES</div>
                    <div class="tutorial-item-desc">
                        Valuta per crafting e shop. Guadagni Mana Stones completando quest.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">‚öîÔ∏è RANK</div>
                    <div class="tutorial-item-desc">
                        E ‚Üí D ‚Üí C ‚Üí B ‚Üí A ‚Üí S ‚Üí NATIONAL. Sali ogni 10 livelli. A Rank C e A scegli Job Class.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">üë• SHADOW ARMY</div>
                    <div class="tutorial-item-desc">
                        Completa stessa quest x30 giorni consecutivi ‚Üí diventa Shadow che lavora per te automaticamente.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">üî• STREAK</div>
                    <div class="tutorial-item-desc">
                        Giorni consecutivi con almeno 1 quest completata. Pi√π alto lo streak, pi√π bonus EXP ottieni.
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-item-title">üíÄ MORTE</div>
                    <div class="tutorial-item-desc">
                        0 HP = 24h blocco. Penalit√†: -50% Mana Stones, perdi EXP, Shadow Army danneggiata.
                    </div>
                </div>
            </div>

            <div class="quote-box">
                <div class="quote-text">"Il potere non si chiede. Si prende."</div>
            </div>

            <button class="continue-btn" onclick="startApp()">‚öîÔ∏è CONTINUA ‚öîÔ∏è</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" style="display: none;">
    <div class="container">
        <header>
            <h1>‚öîÔ∏è REAL LIFE LEVELING ‚öîÔ∏è</h1>
            <div class="daily-quote" id="dailyQuote"></div>
        </header>

        <!-- Tab: Player -->
        <div id="tab-player" class="tab-content active">
            <div class="streak-display">
                <div style="font-size: 14px; color: #bbb;">STREAK GIORNALIERO</div>
                <div class="streak-number" id="streakDisplay">üî• 0 giorni</div>
                <div class="streak-bonus" id="streakBonus">Bonus: +0% EXP</div>
            </div>

            <div class="player-card">
                <div class="player-name" id="playerName">Hunter Novizio</div>
                <span class="rank" id="playerRank">E</span>
                <span class="job-class" id="playerClass">Nessuna Classe</span>
                <div class="level">Livello: <span id="playerLevel">1</span></div>
                
                <div class="stat-bar hp-bar">
                    <div class="stat-label">
                        <span>HP</span>
                        <span><span id="currentHP">100</span>/<span id="maxHP">100</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="hpBar" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="stat-bar mp-bar">
                    <div class="stat-label">
                        <span>MP</span>
                        <span><span id="currentMP">50</span>/<span id="maxMP">50</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="mpBar" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="stat-bar">
                    <div class="stat-label">
                        <span>EXP</span>
                        <span><span id="currentEXP">0</span>/<span id="nextLevelEXP">100</span></span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="expBar" style="width: 0%;"></div>
                    </div>
                </div>

                <div class="status-effects" id="statusEffects"></div>

                <div class="stat-points" id="statPointsDisplay">
                    üíé Punti Stat: <span id="availablePoints">0</span> | ‚≠ê Punti Skill: <span id="skillPoints">0</span>
                </div>

                <div class="stats-grid" id="statsGrid">
                    <!-- Stats rendered dynamically with EXP bars -->
                </div>
            </div>

            <div class="section">
                <div class="section-title">üèÜ Titolo Attivo</div>
                <div id="activeTitle" style="text-align: center; font-size: 18px; color: #ffd700;">
                    Nessun Titolo
                </div>
            </div>

            <div class="section">
                <div class="section-title">üìä Radar Stats</div>
                <div class="radar-chart-container">
                    <canvas id="radarChart" width="300" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Tab: Quests -->
        <div id="tab-quests" class="tab-content">
            <div class="section">
                <div class="section-title">üìã Quest Giornaliere</div>
                <div id="penaltyWarning" class="penalty-warning" style="display: none;">
                    ‚ö†Ô∏è ATTENZIONE: Quest giornaliere non completate!<br>
                    Penalit√† attiva: -10 HP
                </div>
                <div id="dailyQuests"></div>
                <button onclick="showCreateQuestModal()" class="complete-btn" style="margin-top: 10px;">
                    ‚úèÔ∏è Crea Quest Personalizzata
                </button>
            </div>

            <div id="emergencyQuestSection" style="display: none;">
                <div class="section">
                    <div class="section-title" style="color: #ff0000;">üö® EMERGENCY QUEST</div>
                    <div id="emergencyQuest"></div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">üíÄ Boss Fight Settimanale</div>
                <div id="bossQuest"></div>
            </div>
        </div>

        <!-- Tab: Progress -->
        <div id="tab-progress" class="tab-content">
            <div class="section">
                <div class="section-title">‚öîÔ∏è Sfida Te Stesso</div>
                <div id="selfComparison"></div>
            </div>

            <div class="section">
                <div class="section-title">üìÖ Calendario Completamenti</div>
                <div id="completionCalendar" style="background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; overflow-x: hidden;"></div>
            </div>

            <div class="section">
                <div class="section-title">üë• Shadow Army</div>
                <div id="shadowArmyList" class="shadow-army-list"></div>
            </div>

            <div class="section">
                <div class="section-title">üèÜ Achievements</div>
                <div id="achievementsList" class="achievement-grid"></div>
            </div>

            <div class="section">
                <div class="section-title">üå≥ Skill Tree</div>
                <div style="text-align: center; margin-bottom: 15px;">
                    ‚≠ê Punti Skill Disponibili: <span id="skillPointsDisplay" style="color: #ffd700; font-weight: bold;">0</span>
                </div>
                <div id="skillTree" class="skill-tree"></div>
            </div>
        </div>

        <!-- Tab: Inventory -->
        <div id="tab-inventory" class="tab-content">
            <div class="section">
                <div class="section-title">üéí Inventario</div>
                <div style="text-align: center; margin-bottom: 15px;">
                    üí∞ Mana Stones: <span id="manaStones" style="color: #ffd700; font-weight: bold;">0</span>
                </div>
                
                <button onclick="showAddItemModal()" class="complete-btn" style="margin-bottom: 15px;">
                    ‚ûï Aggiungi Oggetto
                </button>
                
                <div class="inventory-grid" id="inventoryGrid">
                    <div style="grid-column: 1/-1; text-align: center; color: #999; padding: 40px;">
                        Nessun oggetto nell'inventario.
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">üî® Crafting</div>
                <div id="craftingGrid" class="crafting-grid"></div>
            </div>
        </div>

        <!-- Tab: Settings -->
        <div id="tab-settings" class="tab-content">
            <div class="section">
                <div class="section-title">‚öôÔ∏è Impostazioni</div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px;">Nome Hunter:</label>
                    <input type="text" id="nameInput" placeholder="Inserisci il tuo nome" 
                           style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white;">
                    <button onclick="saveName()" style="margin-top: 10px; width: 100%;" class="complete-btn">Salva Nome</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px;">Professione/Lavoro:</label>
                    <input type="text" id="professionInput" placeholder="Es: Programmatore, Studente, Chef, Medico..." 
                           style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white;">
                    <button onclick="saveProfession()" style="margin-top: 10px; width: 100%;" class="complete-btn">Salva Professione</button>
                    <p style="font-size: 12px; color: #bbb; margin-top: 10px; line-height: 1.4;">
                        üí° Le quest verranno generate in base alla tua professione. Lascia vuoto per quest generali.
                    </p>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px;">
                        <input type="checkbox" id="notificationsEnabled" onchange="toggleNotifications()"> 
                        Abilita Notifiche Push
                    </label>
                </div>

                <button onclick="showWelcomeTutorial()" class="complete-btn" style="margin-bottom: 10px; width: 100%;">
                    üìñ Rivedi Tutorial
                </button>
                
                <button onclick="resetProgress()" class="reset-btn" style="width: 100%;">üîÑ Reset Progresso</button>

                <div style="margin: 20px 0; padding: 20px; background: rgba(255,215,0,0.1); border-radius: 10px; text-align: center;">
                    <h3 style="color: #ffd700; margin-bottom: 10px;">üí™ Supporta lo sviluppo!</h3>
                    <p style="color: #bbb; font-size: 14px; margin-bottom: 15px;">Ogni donazione aiuta a migliorare l'app</p>
                    
                    <a href="https://revolut.me/tuonome" target="_blank" 
                       style="display: inline-block; padding: 15px 40px; background: #ffd700; color: #000; text-decoration: none; border-radius: 10px; font-weight: bold; font-size: 16px;">
                        üí≥ Dona con Revolut
                    </a>
                    
                    <p style="font-size: 11px; color: #888; margin-top: 15px;">‚ö†Ô∏è Sostituisci "tuonome" con il tuo username Revolut</p>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-btn active" onclick="switchTab('player')">
                <span class="nav-icon">üë§</span>
                <span>Player</span>
            </button>
            <button class="nav-btn" onclick="switchTab('quests')">
                <span class="nav-icon">üìã</span>
                <span>Quests</span>
            </button>
            <button class="nav-btn" onclick="switchTab('progress')">
                <span class="nav-icon">üìà</span>
                <span>Progress</span>
            </button>
            <button class="nav-btn" onclick="switchTab('inventory')">
                <span class="nav-icon">üéí</span>
                <span>Inventory</span>
            </button>
            <button class="nav-btn" onclick="switchTab('settings')">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span>Settings</span>
            </button>
        </div>
    </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Death Screen -->
    <div class="death-screen" id="deathScreen">
        <div class="death-title">‚ö∞Ô∏è SEI MORTO ‚ö∞Ô∏è</div>
        <div class="death-timer" id="deathTimer">23:59:59</div>
        <div class="death-message">
            Hai raggiunto 0 HP.<br><br>
            Penalit√†:<br>
            - Perso 50% Mana Stones<br>
            - Perso progresso EXP verso prossimo livello<br>
            - Shadow Army ridotta di 1 livello<br><br>
            Resurrezione automatica tra...
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="addItemModal" class="modal">
        <div class="modal-content">
            <h3 style="color: #ffd700; margin-bottom: 20px;">‚ûï Aggiungi Oggetto</h3>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #bbb;">Icona (Emoji)</label>
                <input type="text" id="itemIcon" placeholder="üì¶" maxlength="2" 
                       style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white; font-size: 20px; text-align: center;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #bbb;">Nome Oggetto</label>
                <input type="text" id="itemName" placeholder="Es: Laptop" 
                       style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #bbb;">Quantit√†</label>
                <input type="number" id="itemQuantity" value="1" min="1" 
                       style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white;">
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; color: #bbb;">Effetto Bonus (opzionale)</label>
                <select id="itemEffect" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white;">
                    <option value="">Nessun Effetto</option>
                    <option value="coding">+10% EXP Coding</option>
                    <option value="study">+10% EXP Studio</option>
                    <option value="fitness">+10% EXP Fitness</option>
                    <option value="creative">+10% EXP Creativit√†</option>
                    <option value="hp_regen">+5 HP ogni giorno</option>
                    <option value="mp_regen">+3 MP ogni giorno</option>
                </select>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button onclick="addItemToInventory()" class="complete-btn" style="flex: 1;">Aggiungi</button>
                <button onclick="closeAddItemModal()" class="reset-btn" style="flex: 1;">Annulla</button>
            </div>
        </div>
    </div>

    <!-- Create Quest Modal -->
    <div id="createQuestModal" class="modal">
        <div class="modal-content">
            <h3 style="color: #ffd700; margin-bottom: 20px;">‚úèÔ∏è Crea Quest Personalizzata</h3>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #bbb;">Titolo Quest</label>
                <input type="text" id="customQuestTitle" placeholder="Es: Finire progetto X" 
                       style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; color: #bbb;">Descrizione</label>
                <textarea id="customQuestDesc" placeholder="Descrivi cosa devi fare..." rows="3"
                       style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white; resize: none;"></textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; color: #bbb;">Difficolt√† Stimata</label>
                <select id="customQuestDifficulty" style="width: 100%; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.3); border: 1px solid rgba(106, 90, 205, 0.5); color: white;">
                    <option value="easy">Facile (30-40 EXP)</option>
                    <option value="medium">Media (50-70 EXP)</option>
                    <option value="hard">Difficile (80-100 EXP)</option>
                    <option value="extreme">Estrema (120-150 EXP)</option>
                </select>
            </div>

            <div style="margin-bottom: 20px; padding: 15px; background: rgba(106, 90, 205, 0.1); border-radius: 10px; border: 1px solid rgba(106, 90, 205, 0.3);">
                <label style="display: block; margin-bottom: 10px; color: #ffd700; font-weight: bold;">üîÑ Ricorrenza</label>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: pointer;">
                        <input type="radio" name="recurrence" value="once" checked onchange="toggleRecurrenceOptions()" style="margin-right: 8px;">
                        <span style="color: #ddd;">Una volta sola</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="radio" name="recurrence" value="recurring" onchange="toggleRecurrenceOptions()" style="margin-right: 8px;">
                        <span style="color: #ddd;">Ricorrente</span>
                    </label>
                </div>

                <div id="recurrenceOptions" style="display: none; margin-top: 15px; padding-left: 10px;">
                    <label style="display: block; margin-bottom: 10px; color: #bbb;">Quando ripetere?</label>
                    
                    <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: pointer;">
                        <input type="radio" name="recurrenceType" value="daily" checked style="margin-right: 8px;">
                        <span style="color: #ddd;">Ogni giorno</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: pointer;">
                        <input type="radio" name="recurrenceType" value="weekdays" style="margin-right: 8px;">
                        <span style="color: #ddd;">Solo giorni lavorativi (Lun-Ven)</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: pointer;">
                        <input type="radio" name="recurrenceType" value="weekend" style="margin-right: 8px;">
                        <span style="color: #ddd;">Solo weekend (Sab-Dom)</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; margin-bottom: 12px; cursor: pointer;">
                        <input type="radio" name="recurrenceType" value="specific" onchange="toggleDaySelector()" style="margin-right: 8px;">
                        <span style="color: #ddd;">Giorni specifici:</span>
                    </label>
                    
                    <div id="daySelector" style="display: none; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-left: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px;">
                            <label style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                                <input type="checkbox" class="day-checkbox" value="1" style="margin-bottom: 4px;">
                                <span style="font-size: 12px; color: #bbb;">Lun</span>
                            </label>
                            <label style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                                <input type="checkbox" class="day-checkbox" value="2" style="margin-bottom: 4px;">
                                <span style="font-size: 12px; color: #bbb;">Mar</span>
                            </label>
                            <label style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                                <input type="checkbox" class="day-checkbox" value="3" style="margin-bottom: 4px;">
                                <span style="font-size: 12px; color: #bbb;">Mer</span>
                            </label>
                            <label style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                                <input type="checkbox" class="day-checkbox" value="4" style="margin-bottom: 4px;">
                                <span style="font-size: 12px; color: #bbb;">Gio</span>
                            </label>
                            <label style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                                <input type="checkbox" class="day-checkbox" value="5" style="margin-bottom: 4px;">
                                <span style="font-size: 12px; color: #bbb;">Ven</span>
                            </label>
                            <label style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                                <input type="checkbox" class="day-checkbox" value="6" style="margin-bottom: 4px;">
                                <span style="font-size: 12px; color: #bbb;">Sab</span>
                            </label>
                            <label style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                                <input type="checkbox" class="day-checkbox" value="0" style="margin-bottom: 4px;">
                                <span style="font-size: 12px; color: #bbb;">Dom</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button onclick="createCustomQuest()" class="complete-btn" style="flex: 1;">Crea Quest</button>
                <button onclick="closeCreateQuestModal()" class="reset-btn" style="flex: 1;">Annulla</button>
            </div>
        </div>
    </div>

    <script>
        // Machiavellian Quotes
        const machiavelliQuotes = {
            daily: [
                "√à meglio essere temuto che amato, se non si pu√≤ essere entrambi.",
                "Il fine giustifica i mezzi. Sempre.",
                "Chi esita √® perduto. Chi attacca primo controlla il campo.",
                "La fortuna favorisce chi sa coglierla, non chi la aspetta.",
                "Non chiedere permesso. Chiedi perdono dopo aver vinto.",
                "Ogni battaglia vinta prima di essere combattuta √® pura strategia.",
                "La debolezza invita l'aggressione. La forza impone rispetto.",
                "Chi sa fingere regna. Chi mostra tutto perde.",
                "Al vertice si √® sempre soli. Abituati.",
                "La piet√† verso i nemici √® crudelt√† verso te stesso.",
                "I principi morali non conquistano regni.",
                "L'ambizione senza azione √® solo un sogno.",
                "Prendi tutto. Non lasciare nulla agli altri.",
                "O domini o sei dominato. Non c'√® via di mezzo.",
                "Nessuno ti dar√† niente. Prendi tutto.",
                "L'unico su cui puoi contare sei tu stesso."
            ]
        };

        function getDailyQuote() {
            const today = new Date().toDateString();
            const stored = localStorage.getItem('dailyQuoteDate');
            if (stored !== today) {
                const randomQuote = machiavelliQuotes.daily[Math.floor(Math.random() * machiavelliQuotes.daily.length)];
                localStorage.setItem('dailyQuote', randomQuote);
                localStorage.setItem('dailyQuoteDate', today);
            }
            return localStorage.getItem('dailyQuote') || machiavelliQuotes.daily[0];
        }

        function startApp() {
            localStorage.setItem('welcomeShown', 'true');
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadGame();
        }

        function showWelcomeTutorial() {
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('welcomeScreen').style.display = 'block';
        }

        // Stat mapping
        const statNames = {
            str: 'Forza',
            agi: 'Agilit√†',
            int: 'Intelligenza',
            vit: 'Vitalit√†',
            sen: 'Sensi',
            luck: 'Fortuna'
        };

        const statCategories = {
            str: 'physical',
            agi: 'physical',
            vit: 'health',
            int: 'intelligence',
            sen: 'social',
            luck: 'productivity'
        };

        // Game State
        let gameState = {
            player: {
                name: "Hunter Novizio",
                level: 1,
                exp: 0,
                hp: 100,
                maxHP: 100,
                mp: 50,
                maxMP: 50,
                stats: {
                    str: 10,
                    agi: 10,
                    int: 10,
                    vit: 10,
                    sen: 10,
                    luck: 10
                },
                statExp: {
                    str: 0,
                    agi: 0,
                    int: 0,
                    vit: 0,
                    sen: 0,
                    luck: 0
                },
                statPoints: 0,
                skillPoints: 0,
                rank: 'E',
                jobClass: 'none',
                profession: 'none',
                activeTitle: null,
                statusEffects: [],
                deathTime: null,
                streak: 0,
                lastQuestDate: null,
                radarStats: {
                    physical: 0,
                    intelligence: 0,
                    health: 0,
                    social: 0,
                    productivity: 0,
                    creativity: 0
                }
            },
            inventory: {
                manaStones: 0,
                items: []
            },
            quests: {
                daily: [],
                emergency: null,
                boss: null,
                custom: []
            },
            shadowArmy: [],
            achievements: [],
            skills: [],
            history: {
                yesterday: { quests: 0, exp: 0 },
                lastWeek: { quests: 0, exp: 0 },
                lastMonth: { quests: 0, exp: 0 }
            },
            lastDailyReset: null,
            lastWeeklyReset: null,
            lastEmergencyCheck: null,
            notificationsEnabled: false,
            firstLoginDate: null,
            totalDaysUsed: 0,
            milestonesReached: [],
            completionCalendar: {} // formato: "2026-02-20": { completed: true/false, total: 5, done: 5 }
        };

        // Quest templates by category
        const questTemplates = {
            fitness: [
                { title: "Allenamento Mattutino", description: "100 flessioni, 100 addominali, 100 squat", reward: 50, category: "physical" },
                { title: "Cardio Training", description: "Corri per 5km o 30 minuti", reward: 45, category: "physical" },
                { title: "Stretching", description: "15 minuti di stretching completo", reward: 30, category: "physical" },
                { title: "Forza", description: "Allenamento pesi per 45 minuti", reward: 55, category: "physical" },
                { title: "Yoga Session", description: "30 minuti di yoga", reward: 40, category: "physical" }
            ],
            mental: [
                { title: "Meditazione", description: "Medita per 15 minuti", reward: 30, category: "intelligence" },
                { title: "Lettura", description: "Leggi per 30 minuti", reward: 40, category: "intelligence" },
                { title: "Journaling", description: "Scrivi nel tuo diario per 10 minuti", reward: 25, category: "intelligence" },
                { title: "Apprendimento", description: "Studia qualcosa di nuovo per 1 ora", reward: 60, category: "intelligence" }
            ],
            health: [
                { title: "Idratazione", description: "Bevi 2 litri d'acqua", reward: 20, category: "health" },
                { title: "Alimentazione Sana", description: "Mangia 5 porzioni di frutta/verdura", reward: 35, category: "health" },
                { title: "Sonno", description: "Dormi almeno 7 ore", reward: 30, category: "health" },
                { title: "No Junk Food", description: "Evita cibo spazzatura tutto il giorno", reward: 40, category: "health" }
            ],
            social: [
                { title: "Connessione Sociale", description: "Chiama un amico o familiare", reward: 35, category: "social" },
                { title: "Atto di Gentilezza", description: "Fai un gesto gentile per qualcuno", reward: 40, category: "social" },
                { title: "Networking", description: "Incontra una nuova persona", reward: 50, category: "social" }
            ],
            productivity: [
                { title: "Deep Work", description: "2 ore di lavoro concentrato senza distrazioni", reward: 70, category: "productivity" },
                { title: "Organizzazione", description: "Organizza la tua giornata e priorit√†", reward: 30, category: "productivity" },
                { title: "Pulizia Spazio", description: "Pulisci e organizza il tuo spazio di lavoro", reward: 35, category: "productivity" },
                { title: "Email Zero", description: "Svuota la inbox email", reward: 40, category: "productivity" }
            ],
            programmer: [
                { title: "Code Review", description: "Rivedi e refactorizza 100 righe di codice", reward: 60, category: "productivity" },
                { title: "Bug Hunting", description: "Risolvi almeno 3 bug", reward: 70, category: "productivity" },
                { title: "New Feature", description: "Implementa una nuova funzionalit√†", reward: 80, category: "productivity" },
                { title: "Documentazione", description: "Documenta il codice scritto oggi", reward: 50, category: "productivity" },
                { title: "Learning", description: "Impara un nuovo framework/linguaggio per 1h", reward: 65, category: "intelligence" }
            ],
            student: [
                { title: "Studio Intensivo", description: "Studia per 3 ore", reward: 70, category: "intelligence" },
                { title: "Esercizi", description: "Completa 20 esercizi", reward: 60, category: "intelligence" },
                { title: "Ripasso", description: "Ripassa gli appunti della settimana", reward: 50, category: "intelligence" },
                { title: "Progetto", description: "Lavora al progetto per 2 ore", reward: 75, category: "productivity" }
            ],
            creative: [
                { title: "Creazione Artistica", description: "Crea qualcosa per 1 ora (arte, musica, scrittura)", reward: 60, category: "creativity" },
                { title: "Brainstorming", description: "Genera 20 nuove idee per progetti", reward: 45, category: "creativity" },
                { title: "Portfolio", description: "Aggiungi un pezzo al tuo portfolio", reward: 70, category: "creativity" }
            ],
            business: [
                { title: "Strategia", description: "Pianifica la strategia della settimana", reward: 65, category: "productivity" },
                { title: "Client Meeting", description: "Incontra un cliente o potenziale cliente", reward: 70, category: "social" },
                { title: "Marketing", description: "Crea contenuto per social/marketing", reward: 60, category: "creativity" },
                { title: "Financial Review", description: "Analizza finanze e metriche", reward: 55, category: "intelligence" }
            ]
        };

        // Emergency Quest Templates
        const emergencyQuestTemplates = {
            programmer: [
                { title: "üö® Critical Bug in Production", description: "Bug critico in produzione! Risolvilo entro 4 ore", reward: 200 },
                { title: "‚ö° Hackathon Challenge", description: "Crea un'app funzionante in 12 ore", reward: 250 },
                { title: "üî• Hotfix Required", description: "Deploy hotfix entro 3 ore", reward: 180 }
            ],
            student: [
                { title: "üìö Exam Preparation Sprint", description: "Studia 8 ore no-stop per l'esame", reward: 220 },
                { title: "üìù Last Minute Assignment", description: "Completa tutto il progetto oggi", reward: 200 },
                { title: "üéØ Final Preparation", description: "Ripassa tutto il materiale in 10 ore", reward: 210 }
            ],
            business: [
                { title: "üíº Closing Deal", description: "Chiudi un contratto importante oggi", reward: 300 },
                { title: "üéØ Pitch Perfect", description: "Prepara e presenta pitch perfetto in 6 ore", reward: 230 },
                { title: "üìä Crisis Management", description: "Risolvi la crisi aziendale entro 8 ore", reward: 250 }
            ],
            creative: [
                { title: "üé® Deadline Crunch", description: "Completa il progetto creativo entro 10 ore", reward: 240 },
                { title: "‚ú® Creative Marathon", description: "Crea 5 pezzi di qualit√† oggi", reward: 220 },
                { title: "üöÄ Launch Day", description: "Finalizza e lancia il progetto oggi", reward: 260 }
            ],
            general: [
                { title: "üí™ 100 Days Tribute", description: "200 flessioni + 200 squat + 20km oggi", reward: 180 },
                { title: "üèÉ Marathon Challenge", description: "Corri una mezza maratona oggi", reward: 250 },
                { title: "üßò Zen Master", description: "Medita per 3 ore totali oggi", reward: 150 }
            ]
        };

        // Boss Quest Templates
        const bossQuestTemplates = {
            programmer: [
                { title: "üíÄ Final Boss: Major Release", description: "Completa e deploya un major release questa settimana con zero bug critici", reward: 500 }
            ],
            student: [
                { title: "üíÄ Final Boss: Perfect Week", description: "Completa tutti gli assignment + studia 40 ore questa settimana", reward: 500 }
            ],
            business: [
                { title: "üíÄ Final Boss: Growth Sprint", description: "Ottieni 10 nuovi clienti questa settimana", reward: 600 }
            ],
            creative: [
                { title: "üíÄ Final Boss: Creative Marathon", description: "Completa 3 progetti maggiori questa settimana", reward: 550 }
            ],
            general: [
                { title: "üíÄ Final Boss: Perfect Week", description: "Completa TUTTE le quest giornaliere per 7 giorni + 50km corsa totale", reward: 500 }
            ]
        };

        // Achievements definitions
        const achievementDefinitions = [
            { id: 'iron_will', icon: 'üí™', title: 'Iron Will', desc: '30 giorni streak', unlocked: false, bonus: '+10 HP permanente' },
            { id: 'early_bird', icon: 'üåÖ', title: 'Early Bird', desc: 'Quest prima 8am x7 giorni', unlocked: false, bonus: '+5% EXP mattina' },
            { id: 'perfectionist', icon: '‚ú®', title: 'Perfectionist', desc: '100% quest x1 mese', unlocked: false, bonus: '+10% EXP totale' },
            { id: 'shadow_master', icon: 'üë•', title: 'Shadow Master', desc: '10 Shadow Army attive', unlocked: false, bonus: '+20 MP permanente' },
            { id: 'survivor', icon: '‚ö∞Ô∏è', title: 'Survivor', desc: 'Resurrezione da morte', unlocked: false, bonus: '+15% HP regen' },
            { id: 'scholar', icon: 'üìö', title: 'Scholar', desc: '100 quest intellettuali', unlocked: false, bonus: '+15 INT' },
            { id: 'warrior', icon: '‚öîÔ∏è', title: 'Warrior', desc: '100 quest fisiche', unlocked: false, bonus: '+15 STR' },
            { id: 'emergency_hero', icon: 'üö®', title: 'Emergency Hero', desc: '5 Emergency Quest completate', unlocked: false, bonus: '+100 HP max' }
        ];

        // Skills definitions
        const skillDefinitions = {
            combat: [
                { id: 'second_wind', name: 'Second Wind', desc: 'Recupera 20 HP 1 volta al giorno', cost: 1, unlocked: false },
                { id: 'berserker', name: 'Berserker', desc: '+50% EXP quando HP < 20%', cost: 2, unlocked: false, requires: 'second_wind' },
                { id: 'immortal', name: 'Immortal', desc: 'Sopravvivi a 0 HP 1 volta (no death penalty)', cost: 3, unlocked: false, requires: 'berserker' }
            ],
            magic: [
                { id: 'mana_boost', name: 'Mana Boost', desc: '+20 MP max', cost: 1, unlocked: false },
                { id: 'double_exp', name: 'Double EXP', desc: '1 quest al giorno d√† 2x EXP', cost: 2, unlocked: false, requires: 'mana_boost' },
                { id: 'time_master', name: 'Time Master', desc: '+2 ore su deadline Emergency Quest', cost: 3, unlocked: false, requires: 'double_exp' }
            ],
            support: [
                { id: 'lucky_charm', name: 'Lucky Charm', desc: '+10% chance Emergency Quest', cost: 1, unlocked: false },
                { id: 'wealthy', name: 'Wealthy', desc: '+50% Mana Stones da quest', cost: 2, unlocked: false, requires: 'lucky_charm' },
                { id: 'master_crafter', name: 'Master Crafter', desc: 'Sblocca ricette rare', cost: 3, unlocked: false, requires: 'wealthy' }
            ]
        };

        // Crafting recipes
        const craftingRecipes = [
            { 
                id: 'hp_potion', 
                name: '‚ù§Ô∏è HP Potion', 
                materials: [{ name: 'Mana Stones', count: 50 }], 
                result: { type: 'consumable', effect: 'restore_hp', value: 50 },
                unlocked: true 
            },
            { 
                id: 'exp_boost', 
                name: '‚≠ê EXP Boost', 
                materials: [{ name: 'Mana Stones', count: 100 }], 
                result: { type: 'buff', effect: 'exp_boost', value: 20, duration: 3600000 },
                unlocked: true 
            },
            { 
                id: 'shield', 
                name: 'üõ°Ô∏è Emergency Shield', 
                materials: [{ name: 'Mana Stones', count: 200 }], 
                result: { type: 'buff', effect: 'damage_reduction', value: 50, duration: 86400000 },
                unlocked: false 
            }
        ];

        // Job Classes
        const jobClasses = {
            E: { name: 'Nessuna Classe', bonuses: {} },
            D: { name: 'Nessuna Classe', bonuses: {} },
            C: { 
                options: ['Tank', 'Assassin', 'Mage'],
                Tank: { name: 'Tank', bonuses: { hp: 50, def: 20 } },
                Assassin: { name: 'Assassin', bonuses: { agi: 15, crit: 10 } },
                Mage: { name: 'Mage', bonuses: { int: 15, mp: 30 } }
            },
            B: { name: 'Inherited from C', bonuses: {} },
            A: {
                options: ['Shadow Monarch', 'Berserker', 'Sage'],
                'Shadow Monarch': { name: 'Shadow Monarch', bonuses: { shadow_power: 50 } },
                Berserker: { name: 'Berserker', bonuses: { str: 25, hp: 100 } },
                Sage: { name: 'Sage', bonuses: { int: 25, mp: 50 } }
            },
            S: { name: 'Inherited from A', bonuses: {} },
            NATIONAL: { name: 'National Level Hunter', bonuses: { all_stats: 50 } }
        };

        // Initialize
        if (!localStorage.getItem('welcomeShown')) {
            document.getElementById('welcomeScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
        } else {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadGame();
        }
        setInterval(checkEmergencyQuest, 3600000); // Check every hour
        setInterval(updateTimers, 1000); // Update timers every second
        setInterval(checkDeath, 1000); // Check death status

        function updateTotalDaysUsed() {
            if (!gameState.firstLoginDate) return;
            
            const firstLogin = new Date(gameState.firstLoginDate);
            const today = new Date();
            const daysDiff = Math.floor((today - firstLogin) / (1000 * 60 * 60 * 24));
            gameState.totalDaysUsed = Math.max(1, daysDiff + 1);
        }

        function checkMilestones() {
            const milestones = [
                { days: 7, name: 'first_week', title: 'üéâ First Week Survivor', expReward: 200, message: '7 giorni di uso consecutivo! Incredibile!' },
                { days: 30, name: 'monthly_champion', title: 'üèÜ Monthly Champion', expReward: 500, message: '30 giorni! Sei un vero Hunter!' },
                { days: 100, name: 'centurion', title: 'üí™ Centurion', expReward: 1000, message: '100 giorni! Potere assoluto!' },
                { days: 365, name: 'eternal_hunter', title: '‚≠ê Eternal Hunter', expReward: 2000, message: 'UN ANNO! Sei una leggenda vivente!' }
            ];
            
            milestones.forEach(milestone => {
                if (gameState.totalDaysUsed >= milestone.days && !gameState.milestonesReached.includes(milestone.name)) {
                    gameState.milestonesReached.push(milestone.name);
                    
                    // Give rewards
                    gainEXP(milestone.expReward);
                    
                    // Unlock title if not exists
                    if (!gameState.achievements.some(a => a.id === milestone.name)) {
                        gameState.achievements.push({
                            id: milestone.name,
                            name: milestone.title,
                            description: milestone.message,
                            unlocked: true,
                            bonus: `+${milestone.expReward} EXP`,
                            icon: milestone.title.split(' ')[0]
                        });
                    }
                    
                    // Show celebration
                    showMilestoneCelebration(milestone);
                    
                    saveGame();
                }
            });
        }

        function showMilestoneCelebration(milestone) {
            const celebration = document.createElement('div');
            celebration.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 40px;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.5);
                z-index: 10001;
                text-align: center;
                max-width: 90%;
                animation: bounceIn 0.6s ease-out;
            `;
            
            celebration.innerHTML = `
                <div style="font-size: 60px; margin-bottom: 20px;">üéâ</div>
                <div style="font-size: 28px; font-weight: bold; color: #ffd700; margin-bottom: 15px;">
                    MILESTONE RAGGIUNTO!
                </div>
                <div style="font-size: 24px; color: white; margin-bottom: 10px;">
                    ${milestone.title}
                </div>
                <div style="font-size: 16px; color: #e0e0e0; margin-bottom: 20px;">
                    ${milestone.message}
                </div>
                <div style="font-size: 20px; color: #4ecdc4; font-weight: bold; margin-bottom: 30px;">
                    +${milestone.expReward} EXP!
                </div>
                <button onclick="this.parentElement.remove()" style="
                    background: #ffd700;
                    color: #000;
                    border: none;
                    padding: 15px 40px;
                    border-radius: 10px;
                    font-size: 18px;
                    font-weight: bold;
                    cursor: pointer;
                    box-shadow: 0 4px 15px rgba(255,215,0,0.4);
                ">
                    FANTASTICO! üî•
                </button>
            `;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes bounceIn {
                    0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                    50% { transform: translate(-50%, -50%) scale(1.05); }
                    70% { transform: translate(-50%, -50%) scale(0.9); }
                    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(celebration);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (celebration.parentElement) {
                    celebration.remove();
                }
            }, 10000);
        }

        function loadGame() {
            const saved = localStorage.getItem('realLifeLevelingComplete');
            if (saved) {
                const savedState = JSON.parse(saved);
                gameState = {...gameState, ...savedState};
                
                // Initialize missing properties for backward compatibility
                if (!gameState.player.radarStats) {
                    gameState.player.radarStats = {
                        physical: 0, intelligence: 0, health: 0,
                        social: 0, productivity: 0, creativity: 0
                    };
                }
                if (!gameState.player.statusEffects) gameState.player.statusEffects = [];
                if (!gameState.player.streak) gameState.player.streak = 0;
                if (!gameState.player.lastQuestDate) gameState.player.lastQuestDate = null;
                if (!gameState.player.statExp) {
                    gameState.player.statExp = {
                        str: 0, agi: 0, int: 0, vit: 0, sen: 0, luck: 0
                    };
                }
                if (!gameState.history) {
                    gameState.history = {
                        yesterday: { quests: 0, exp: 0 },
                        lastWeek: { quests: 0, exp: 0 },
                        lastMonth: { quests: 0, exp: 0 }
                    };
                }
                if (!gameState.achievements) {
                    gameState.achievements = achievementDefinitions.map(a => ({...a}));
                }
                if (!gameState.skills) {
                    gameState.skills = {
                        combat: skillDefinitions.combat.map(s => ({...s})),
                        magic: skillDefinitions.magic.map(s => ({...s})),
                        support: skillDefinitions.support.map(s => ({...s}))
                    };
                }
                if (!gameState.firstLoginDate) {
                    gameState.firstLoginDate = new Date().toISOString();
                }
                if (!gameState.totalDaysUsed) gameState.totalDaysUsed = 0;
                if (!gameState.milestonesReached) gameState.milestonesReached = [];
                if (!gameState.completionCalendar) gameState.completionCalendar = {};
                
                updateTotalDaysUsed();
                checkDailyReset();
            } else {
                gameState.quests.daily = generateDailyQuests();
                gameState.quests.boss = generateBossQuest();
                gameState.lastDailyReset = new Date().toDateString();
                gameState.lastWeeklyReset = new Date().toDateString();
                gameState.lastEmergencyCheck = Date.now();
                gameState.firstLoginDate = new Date().toISOString();
                gameState.totalDaysUsed = 1;
                gameState.milestonesReached = [];
                gameState.achievements = achievementDefinitions.map(a => ({...a}));
                gameState.skills = {
                    combat: skillDefinitions.combat.map(s => ({...s})),
                    magic: skillDefinitions.magic.map(s => ({...s})),
                    support: skillDefinitions.support.map(s => ({...s}))
                };
            }
            
            applyItemEffects();
            document.getElementById('dailyQuote').textContent = getDailyQuote();
            updateUI();
            drawRadarChart();
            checkMilestones();
            requestNotificationPermission();
        }

        function saveGame() {
            localStorage.setItem('realLifeLevelingComplete', JSON.stringify(gameState));
        }

        function checkDailyReset() {
            const today = new Date().toDateString();
            const todayISO = new Date().toISOString().split('T')[0];
            
            if (gameState.lastDailyReset !== today) {
                // Track daily completion for calendar
                const acceptedDaily = gameState.quests.daily.filter(q => q.accepted);
                const acceptedCustom = (gameState.quests.custom || []).filter(q => !q.recurring || shouldShowRecurringQuest(q, new Date(gameState.lastDailyReset || Date.now())));
                const totalAccepted = acceptedDaily.length + acceptedCustom.length;
                const totalCompleted = [...gameState.quests.daily, ...(gameState.quests.custom || [])].filter(q => q.completed).length;
                
                if (!gameState.completionCalendar) gameState.completionCalendar = {};
                
                const yesterdayISO = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                if (gameState.lastDailyReset) {
                    gameState.completionCalendar[yesterdayISO] = {
                        completed: totalAccepted > 0 && totalCompleted === totalAccepted,
                        total: totalAccepted,
                        done: totalCompleted
                    };
                }
                
                const allCompleted = gameState.quests.daily.every(q => q.completed);
                
                // Save today's data as yesterday's before reset (including custom quests)
                const dailyCompleted = gameState.quests.daily.filter(q => q.completed).length;
                const customCompleted = (gameState.quests.custom || []).filter(q => q.completed).length;
                gameState.history.yesterday = {
                    quests: dailyCompleted + customCompleted,
                    exp: gameState.player.exp
                };
                
                if (!allCompleted && gameState.player.deathTime === null) {
                    takeDamage(10, "Quest giornaliere non completate");
                }
                
                // Update shadow army streaks
                gameState.quests.daily.forEach(quest => {
                    if (quest.completed) {
                        updateShadowArmy(quest);
                    } else {
                        breakShadowStreak(quest);
                    }
                });
                
                // Handle recurring custom quests
                if (gameState.quests.custom) {
                    gameState.quests.custom.forEach(quest => {
                        if (quest.recurring && quest.completed) {
                            // Track completion
                            if (!quest.completionHistory) quest.completionHistory = [];
                            quest.completionHistory.push(yesterdayISO);
                            
                            // Update shadow army for recurring quests
                            updateShadowArmy(quest);
                        } else if (quest.recurring && !quest.completed) {
                            breakShadowStreak(quest);
                        }
                        
                        // Reset recurring quests if they should appear today
                        if (quest.recurring && shouldShowRecurringQuest(quest, new Date())) {
                            quest.completed = false;
                        }
                    });
                    
                    // Remove non-recurring completed custom quests
                    gameState.quests.custom = gameState.quests.custom.filter(q => 
                        !q.completed || q.recurring
                    );
                }
                
                gameState.quests.daily = generateDailyQuests();
                gameState.lastDailyReset = today;
                saveGame();
            }
            
            // Check weekly reset
            const lastReset = new Date(gameState.lastWeeklyReset || 0);
            const now = new Date();
            const daysSinceReset = Math.floor((now - lastReset) / (1000 * 60 * 60 * 24));
            const currentDay = now.getDay();
            
            if (!gameState.lastWeeklyReset || (daysSinceReset >= 7 && currentDay === 1)) {
                if (gameState.quests.boss && !gameState.quests.boss.completed) {
                    takeDamage(30, "Boss Fight non completata");
                }
                gameState.quests.boss = generateBossQuest();
                gameState.lastWeeklyReset = now.toDateString();
                saveGame();
            }
        }

        function shouldShowRecurringQuest(quest, date) {
            if (!quest.recurring || !quest.recurrence) return false;
            
            const dayOfWeek = date.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            
            if (quest.recurrence.type === 'daily') {
                return true;
            } else if (quest.recurrence.type === 'weekdays') {
                return dayOfWeek >= 1 && dayOfWeek <= 5;
            } else if (quest.recurrence.type === 'weekend') {
                return dayOfWeek === 0 || dayOfWeek === 6;
            } else if (quest.recurrence.type === 'specific') {
                return quest.recurrence.days.includes(dayOfWeek);
            }
            
            return false;
        }

        function generateDailyQuests() {
            const quests = [];
            let questId = Date.now();
            
            const fitnessQuest = questTemplates.fitness[Math.floor(Math.random() * questTemplates.fitness.length)];
            quests.push({...fitnessQuest, id: questId++, completed: false, accepted: false, type: 'daily'});
            
            const healthQuest = questTemplates.health[Math.floor(Math.random() * questTemplates.health.length)];
            quests.push({...healthQuest, id: questId++, completed: false, accepted: false, type: 'daily'});
            
            const mentalQuest = questTemplates.mental[Math.floor(Math.random() * questTemplates.mental.length)];
            quests.push({...mentalQuest, id: questId++, completed: false, accepted: false, type: 'daily'});
            
            // Check if profession exists in templates, otherwise generate custom quest
            if (gameState.player.profession !== 'none' && gameState.player.profession !== '') {
                if (questTemplates[gameState.player.profession]) {
                    // Use predefined template
                    const profQuest = questTemplates[gameState.player.profession][Math.floor(Math.random() * questTemplates[gameState.player.profession].length)];
                    quests.push({...profQuest, id: questId++, completed: false, accepted: false, type: 'daily'});
                } else {
                    // Generate custom quest based on profession text
                    const customQuest = generateCustomProfessionQuest(gameState.player.profession);
                    quests.push({...customQuest, id: questId++, completed: false, accepted: false, type: 'daily'});
                }
            } else {
                const prodQuest = questTemplates.productivity[Math.floor(Math.random() * questTemplates.productivity.length)];
                quests.push({...prodQuest, id: questId++, completed: false, accepted: false, type: 'daily'});
            }
            
            return quests;
        }

        function generateCustomProfessionQuest(profession) {
            const questTemplates = [
                {
                    title: `Compito ${profession}`,
                    description: `Completa un'attivit√† importante legata al tuo lavoro da ${profession}`,
                    reward: 60,
                    category: 'productivity'
                },
                {
                    title: `Progetto ${profession}`,
                    description: `Lavora su un progetto o iniziativa professionale da ${profession}`,
                    reward: 70,
                    category: 'productivity'
                },
                {
                    title: `Skill Development`,
                    description: `Migliora una competenza chiave per un ${profession}`,
                    reward: 65,
                    category: 'intelligence'
                },
                {
                    title: `Networking Professionale`,
                    description: `Connettiti con qualcuno nel settore da ${profession}`,
                    reward: 55,
                    category: 'social'
                },
                {
                    title: `Obiettivo Professionale`,
                    description: `Fai progressi verso un obiettivo di carriera da ${profession}`,
                    reward: 75,
                    category: 'productivity'
                }
            ];
            
            return questTemplates[Math.floor(Math.random() * questTemplates.length)];
        }

        function generateBossQuest() {
            const templates = gameState.player.profession !== 'none' && bossQuestTemplates[gameState.player.profession]
                ? bossQuestTemplates[gameState.player.profession]
                : bossQuestTemplates.general;
            
            const template = templates[Math.floor(Math.random() * templates.length)];
            return {
                ...template,
                id: Date.now(),
                completed: false,
                accepted: false,
                type: 'boss'
            };
        }

        function checkEmergencyQuest() {
            if (gameState.quests.emergency || gameState.player.deathTime) return;
            
            const hoursSinceLastCheck = (Date.now() - (gameState.lastEmergencyCheck || Date.now())) / 3600000;
            
            if (hoursSinceLastCheck < 1) return;
            
            let emergencyChance = 0.05; // 5% base chance per hour
            
            // Increase chance with Lucky Charm skill
            const luckyCharm = gameState.skills.support?.find(s => s.id === 'lucky_charm' && s.unlocked);
            if (luckyCharm) emergencyChance *= 1.1;
            
            if (Math.random() < emergencyChance) {
                generateEmergencyQuest();
            }
            
            gameState.lastEmergencyCheck = Date.now();
            saveGame();
        }

        function generateEmergencyQuest() {
            const templates = gameState.player.profession !== 'none' && emergencyQuestTemplates[gameState.player.profession]
                ? emergencyQuestTemplates[gameState.player.profession]
                : emergencyQuestTemplates.general;
            
            const template = templates[Math.floor(Math.random() * templates.length)];
            
            gameState.quests.emergency = {
                ...template,
                id: Date.now(),
                completed: false,
                accepted: true, // Emergency quests auto-accept
                type: 'emergency',
                deadline: Date.now() + 86400000 // 24 hours
            };
            
            saveGame();
            updateUI();
            
            showNotification("üö® EMERGENCY QUEST DETECTED! üö®", true, true);
            sendPushNotification("Emergency Quest!", template.title);
        }

        function updateUI() {
            // Player stats
            document.getElementById('playerName').textContent = gameState.player.name;
            document.getElementById('playerLevel').textContent = gameState.player.level;
            document.getElementById('playerRank').textContent = gameState.player.rank;
            document.getElementById('playerRank').className = 'rank ' + gameState.player.rank;
            
            const jobClassName = gameState.player.jobClass !== 'none' 
                ? gameState.player.jobClass 
                : 'Nessuna Classe';
            document.getElementById('playerClass').textContent = jobClassName;
            
            document.getElementById('currentHP').textContent = gameState.player.hp;
            document.getElementById('maxHP').textContent = gameState.player.maxHP;
            document.getElementById('currentMP').textContent = gameState.player.mp;
            document.getElementById('maxMP').textContent = gameState.player.maxMP;
            
            const nextLevelEXP = gameState.player.level * 100;
            document.getElementById('currentEXP').textContent = gameState.player.exp;
            document.getElementById('nextLevelEXP').textContent = nextLevelEXP;
            
            // Update Streak Display
            const streakBonus = Math.floor(gameState.player.streak / 7) * 5;
            const streakEmoji = gameState.player.streak >= 30 ? 'üî•üî•üî•üíé' : 
                                gameState.player.streak >= 14 ? 'üî•üî•üî•' : 
                                gameState.player.streak >= 7 ? 'üî•üî•' : 'üî•';
            document.getElementById('streakDisplay').textContent = `${streakEmoji} ${gameState.player.streak} giorni`;
            document.getElementById('streakBonus').textContent = `Bonus: +${streakBonus}% EXP`;
            
            // Update bars with HP warnings
            const hpPercent = (gameState.player.hp / gameState.player.maxHP * 100);
            const hpBar = document.getElementById('hpBar');
            hpBar.style.width = hpPercent + '%';
            hpBar.classList.remove('hp-warning', 'hp-critical');
            if (hpPercent < 30 && hpPercent > 15) {
                hpBar.classList.add('hp-warning');
            } else if (hpPercent <= 15) {
                hpBar.classList.add('hp-critical');
            }
            
            document.getElementById('mpBar').style.width = (gameState.player.mp / gameState.player.maxMP * 100) + '%';
            document.getElementById('expBar').style.width = (gameState.player.exp / nextLevelEXP * 100) + '%';
            
            // Stats
            document.getElementById('skillPoints').textContent = gameState.player.skillPoints;
            document.getElementById('skillPointsDisplay').textContent = gameState.player.skillPoints;
            renderStats();
            
            // Status Effects
            renderStatusEffects();
            
            // Title
            const titleDisplay = gameState.player.activeTitle 
                ? gameState.achievements.find(a => a.id === gameState.player.activeTitle)?.title || 'Nessun Titolo'
                : 'Nessun Titolo';
            document.getElementById('activeTitle').textContent = titleDisplay;
            
            // Inventory
            document.getElementById('manaStones').textContent = gameState.inventory.manaStones;
            renderInventory();
            
            // Quests
            renderQuests();
            
            // Shadow Army
            renderShadowArmy();
            
            // Completion Calendar
            renderCompletionCalendar();
            
            // Self Comparison
            renderSelfComparison();
            
            // Achievements
            renderAchievements();
            
            // Skills
            renderSkillTree();
            
            // Crafting
            renderCrafting();
            
            // Settings
            document.getElementById('professionInput').value = gameState.player.profession === 'none' ? '' : gameState.player.profession;
            document.getElementById('notificationsEnabled').checked = gameState.notificationsEnabled;
            
            // Penalty warning
            const allCompleted = gameState.quests.daily.every(q => q.completed);
            const penaltyWarning = document.getElementById('penaltyWarning');
            if (!allCompleted) {
                penaltyWarning.style.display = 'block';
            } else {
                penaltyWarning.style.display = 'none';
            }
            
            // Update radar chart
            drawRadarChart();
        }

        function renderStats() {
            const container = document.getElementById('statsGrid');
            container.innerHTML = '';
            
            Object.keys(gameState.player.stats).forEach(statKey => {
                const statValue = gameState.player.stats[statKey];
                const statExp = gameState.player.statExp[statKey];
                const expNeeded = 100;
                const expPercent = (statExp / expNeeded) * 100;
                
                const div = document.createElement('div');
                div.className = 'stat-item';
                div.innerHTML = `
                    <div class="stat-header">
                        <div class="stat-name">${statNames[statKey]}</div>
                        <div class="stat-value">${statValue}</div>
                    </div>
                    <div class="stat-exp-bar">
                        <div class="stat-exp-fill" style="width: ${expPercent}%"></div>
                    </div>
                    <div class="stat-exp-label">${statExp}/${expNeeded} EXP</div>
                `;
                container.appendChild(div);
            });
        }

        function renderStatusEffects() {
            const container = document.getElementById('statusEffects');
            container.innerHTML = '';
            
            gameState.player.statusEffects.forEach(effect => {
                const div = document.createElement('div');
                div.className = `status-effect ${effect.type}`;
                div.textContent = `${effect.name} ${effect.duration ? formatTime(effect.duration - Date.now()) : ''}`;
                container.appendChild(div);
            });
        }

        function renderQuests() {
            const dailyContainer = document.getElementById('dailyQuests');
            const emergencySection = document.getElementById('emergencyQuestSection');
            const emergencyContainer = document.getElementById('emergencyQuest');
            const bossContainer = document.getElementById('bossQuest');
            
            dailyContainer.innerHTML = '';
            gameState.quests.daily.forEach(quest => {
                dailyContainer.innerHTML += createQuestHTML(quest);
            });
            
            // Filter custom quests to show only recurring ones on appropriate days
            const today = new Date();
            gameState.quests.custom?.forEach(quest => {
                // Show non-recurring quests or recurring quests on their scheduled days
                if (!quest.recurring || shouldShowRecurringQuest(quest, today)) {
                    const questHTML = createQuestHTML(quest);
                    dailyContainer.innerHTML += questHTML;
                }
            });
            
            if (gameState.quests.emergency) {
                emergencySection.style.display = 'block';
                emergencyContainer.innerHTML = createQuestHTML(gameState.quests.emergency);
            } else {
                emergencySection.style.display = 'none';
            }
            
            if (gameState.quests.boss) {
                bossContainer.innerHTML = createQuestHTML(gameState.quests.boss);
            }
        }

        function createQuestHTML(quest) {
            const timerHTML = quest.accepted && quest.deadline ? `
                <div class="quest-timer">‚è∞ <span id="timer-${quest.id}"></span></div>
            ` : '';
            
            const recurringHTML = quest.recurring ? `
                <span style="background: rgba(106, 90, 205, 0.3); padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px;">
                    üîÑ ${quest.recurrence.type === 'daily' ? 'Ogni giorno' : 
                        quest.recurrence.type === 'weekdays' ? 'Lun-Ven' :
                        quest.recurrence.type === 'weekend' ? 'Sab-Dom' :
                        'Personalizzato'}
                </span>
            ` : '';
            
            const statusHTML = !quest.accepted ? `
                <div class="quest-status">‚ùì Non accettata</div>
            ` : '';
            
            const emergencyClass = quest.type === 'emergency' ? 'emergency' : '';
            const bossClass = quest.type === 'boss' ? 'boss' : '';
            const acceptedClass = quest.accepted ? 'accepted' : '';
            
            const acceptBtn = !quest.accepted && !quest.completed ? `
                <button class="accept-btn" onclick="acceptQuest(${quest.id}, '${quest.type || 'daily'}')">‚úÖ Accetta Quest</button>
            ` : '';
            
            const completeBtn = quest.accepted && !quest.completed ? `
                <button class="complete-btn" onclick="completeQuest(${quest.id}, '${quest.type || 'daily'}')">‚úì Completa</button>
            ` : '';
            
            return `
                <div class="quest-item ${quest.completed ? 'completed' : ''} ${emergencyClass} ${bossClass} ${acceptedClass}">
                    <div class="quest-header">
                        <div class="quest-title">${quest.completed ? '‚úÖ ' : ''}${quest.title}${recurringHTML}</div>
                        <div class="quest-reward">+${quest.reward} EXP</div>
                    </div>
                    <div class="quest-description">${quest.description}</div>
                    ${statusHTML}
                    ${timerHTML}
                    ${acceptBtn}
                    ${completeBtn}
                </div>
            `;
        }

        function acceptQuest(questId, type) {
            let quest;
            
            if (type === 'emergency') {
                quest = gameState.quests.emergency;
            } else if (type === 'boss') {
                quest = gameState.quests.boss;
            } else if (type === 'custom') {
                quest = gameState.quests.custom?.find(q => q.id === questId);
            } else {
                quest = gameState.quests.daily.find(q => q.id === questId);
            }
            
            if (quest && !quest.accepted) {
                quest.accepted = true;
                const duration = quest.duration || 86400000; // Use quest duration or default to 24 hours
                quest.deadline = Date.now() + duration;
                showNotification(`‚úÖ Quest Accettata!`);
                saveGame();
                updateUI();
            }
        }

        function completeQuest(questId, type) {
            let quest;
            
            if (type === 'emergency') {
                quest = gameState.quests.emergency;
            } else if (type === 'boss') {
                quest = gameState.quests.boss;
            } else if (type === 'custom') {
                quest = gameState.quests.custom?.find(q => q.id === questId);
            } else {
                quest = gameState.quests.daily.find(q => q.id === questId);
            }
            
            if (quest && !quest.completed) {
                quest.completed = true;
                
                // Update streak
                const today = new Date().toDateString();
                if (gameState.player.lastQuestDate !== today) {
                    const yesterday = new Date(Date.now() - 86400000).toDateString();
                    if (gameState.player.lastQuestDate === yesterday) {
                        gameState.player.streak++;
                    } else {
                        gameState.player.streak = 1;
                    }
                    gameState.player.lastQuestDate = today;
                }
                
                let expGain = quest.reward;
                
                // Apply streak bonus
                const streakBonus = Math.floor(gameState.player.streak / 7) * 5;
                if (streakBonus > 0) {
                    expGain *= (1 + streakBonus / 100);
                }
                
                // Apply Weekend XP Boost
                const todayDate = new Date();
                const isWeekend = todayDate.getDay() === 0 || todayDate.getDay() === 6;
                if (isWeekend) {
                    expGain *= 1.5;
                    if (!quest.weekendBonusShown) {
                        showNotification("üî• Weekend XP Boost! +50% EXP!");
                        quest.weekendBonusShown = true;
                    }
                }
                
                // Apply EXP bonuses from items
                gameState.inventory.items.forEach(item => {
                    if (item.effect && quest.category) {
                        if (item.effect === 'coding' && quest.category === 'productivity') expGain *= 1.1;
                        if (item.effect === 'study' && quest.category === 'intelligence') expGain *= 1.1;
                        if (item.effect === 'fitness' && quest.category === 'physical') expGain *= 1.1;
                        if (item.effect === 'creative' && quest.category === 'creativity') expGain *= 1.1;
                    }
                });
                
                // Apply Double EXP skill if active
                const doubleExpSkill = gameState.skills.magic?.find(s => s.id === 'double_exp' && s.unlocked);
                if (doubleExpSkill && !quest.doubleExpUsed) {
                    const useDoubleExp = confirm("Vuoi usare Double EXP su questa quest? (1 volta al giorno)");
                    if (useDoubleExp) {
                        expGain *= 2;
                        quest.doubleExpUsed = true;
                        showNotification("‚≠ê Double EXP Attivato!");
                    }
                }
                
                gainEXP(Math.floor(expGain));
                
                // AUTOMATIC STAT PROGRESSION
                if (quest.category) {
                    let statType = null;
                    if (quest.category === 'physical') statType = Math.random() < 0.5 ? 'str' : 'agi';
                    if (quest.category === 'intelligence') statType = 'int';
                    if (quest.category === 'health') statType = 'vit';
                    if (quest.category === 'social') statType = 'sen';
                    if (quest.category === 'productivity') statType = 'luck';
                    if (quest.category === 'creativity') statType = 'int';
                    
                    if (statType) {
                        gameState.player.statExp[statType] += 10;
                        
                        if (gameState.player.statExp[statType] >= 100) {
                            gameState.player.stats[statType]++;
                            gameState.player.statExp[statType] -= 100;
                            
                            if (statType === 'vit') {
                                gameState.player.maxHP += 5;
                                gameState.player.hp += 5;
                            }
                            if (statType === 'int') {
                                gameState.player.maxMP += 3;
                                gameState.player.mp += 3;
                            }
                            
                            showNotification(`‚¨ÜÔ∏è ${statNames[statType]} +1!`);
                        }
                    }
                }
                
                const manaGain = Math.floor(quest.reward / 10);
                gameState.inventory.manaStones += manaGain;
                
                // Update radar stats
                if (quest.category) {
                    gameState.player.radarStats[quest.category] = Math.min(100, gameState.player.radarStats[quest.category] + 2);
                }
                
                showNotification(`‚úÖ Quest completata! +${Math.floor(expGain)} EXP, +${manaGain} Mana Stones`);
                
                if (type === 'emergency') {
                    gameState.quests.emergency = null;
                    checkAchievement('emergency_hero');
                }
                
                checkAchievements();
                saveGame();
                updateUI();
            }
        }

        function gainEXP(amount) {
            gameState.player.exp += amount;
            const nextLevelEXP = gameState.player.level * 100;
            
            if (gameState.player.exp >= nextLevelEXP) {
                levelUp();
            }
        }

        function levelUp() {
            gameState.player.level++;
            gameState.player.exp = 0;
            gameState.player.statPoints += 5;
            gameState.player.maxHP += 10;
            gameState.player.hp = gameState.player.maxHP;
            gameState.player.maxMP += 5;
            gameState.player.mp = gameState.player.maxMP;
            
            // Grant skill points every 5 levels
            if (gameState.player.level % 5 === 0) {
                gameState.player.skillPoints += 1;
            }
            
            // Update rank and offer job class selection
            updateRank();
            
            showNotification(`üéâ LEVEL UP! Sei ora livello ${gameState.player.level}! +5 Stat Points!`);
            sendPushNotification("Level Up!", `Congratulazioni! Ora sei livello ${gameState.player.level}`);
        }

        function updateRank() {
            const oldRank = gameState.player.rank;
            
            if (gameState.player.level >= 100) gameState.player.rank = 'NATIONAL';
            else if (gameState.player.level >= 50) gameState.player.rank = 'S';
            else if (gameState.player.level >= 40) gameState.player.rank = 'A';
            else if (gameState.player.level >= 30) gameState.player.rank = 'B';
            else if (gameState.player.level >= 20) gameState.player.rank = 'C';
            else if (gameState.player.level >= 10) gameState.player.rank = 'D';
            
            if (oldRank !== gameState.player.rank) {
                showNotification(`üéä RANK UP! Ora sei Rank ${gameState.player.rank}!`);
                
                // Offer job class selection at C and A rank
                if (gameState.player.rank === 'C' && gameState.player.jobClass === 'none') {
                    setTimeout(() => offerJobClass('C'), 1000);
                } else if (gameState.player.rank === 'A' && !gameState.player.jobClass.includes('Shadow') && !gameState.player.jobClass.includes('Berserker') && !gameState.player.jobClass.includes('Sage')) {
                    setTimeout(() => offerJobClass('A'), 1000);
                }
            }
        }

        function offerJobClass(rank) {
            const options = jobClasses[rank].options;
            const choice = prompt(`üéä HAI RAGGIUNTO RANK ${rank}!\n\nScegli la tua Job Class:\n\n1. ${options[0]}\n2. ${options[1]}\n3. ${options[2]}\n\nInserisci 1, 2 o 3:`);
            
            if (choice === '1' || choice === '2' || choice === '3') {
                const selectedClass = options[parseInt(choice) - 1];
                gameState.player.jobClass = selectedClass;
                showNotification(`‚öîÔ∏è Sei diventato un ${selectedClass}!`);
                saveGame();
                updateUI();
            }
        }

        function takeDamage(amount, reason) {
            gameState.player.hp = Math.max(0, gameState.player.hp - amount);
            
            showNotification(`‚ö†Ô∏è -${amount} HP: ${reason}`, false, true);
            
            if (gameState.player.hp === 0) {
                triggerDeath();
            }
            
            saveGame();
            updateUI();
        }

        function triggerDeath() {
            // Check Immortal skill
            const immortalSkill = gameState.skills.combat?.find(s => s.id === 'immortal' && s.unlocked);
            if (immortalSkill && !immortalSkill.used) {
                immortalSkill.used = true;
                gameState.player.hp = 1;
                showNotification("üíÄ Immortal Skill Attivato! Sei sopravvissuto con 1 HP!");
                saveGame();
                updateUI();
                return;
            }
            
            // Apply death penalties
            gameState.player.exp = 0;
            gameState.inventory.manaStones = Math.floor(gameState.inventory.manaStones * 0.5);
            
            // Reduce shadow army levels
            gameState.shadowArmy.forEach(shadow => {
                shadow.level = Math.max(1, shadow.level - 1);
                shadow.streak = Math.max(0, shadow.streak - 7);
            });
            
            // Set death timer
            gameState.player.deathTime = Date.now() + 86400000; // 24 hours
            
            showNotification("üíÄ SEI MORTO! Resurrezione tra 24 ore...", false, true);
            sendPushNotification("üíÄ Morte", "Sei morto! L'app sar√† bloccata per 24 ore.");
            
            checkAchievement('survivor');
            
            saveGame();
            updateUI();
        }

        function checkDeath() {
            if (gameState.player.deathTime) {
                const timeLeft = gameState.player.deathTime - Date.now();
                
                if (timeLeft <= 0) {
                    // Resurrection
                    gameState.player.deathTime = null;
                    gameState.player.hp = Math.floor(gameState.player.maxHP * 0.5);
                    document.getElementById('deathScreen').classList.remove('active');
                    showNotification("‚ú® Sei risorto! Benvenuto indietro, Hunter!");
                    saveGame();
                    updateUI();
                } else {
                    // Update death timer
                    document.getElementById('deathScreen').classList.add('active');
                    document.getElementById('deathTimer').textContent = formatTime(timeLeft);
                }
            } else {
                document.getElementById('deathScreen').classList.remove('active');
            }
        }

        function updateTimers() {
            // Update daily quest timers
            gameState.quests.daily.forEach(quest => {
                if (quest.accepted && quest.deadline && !quest.completed) {
                    const timeLeft = quest.deadline - Date.now();
                    const timerEl = document.getElementById(`timer-${quest.id}`);
                    
                    if (timerEl) {
                        if (timeLeft <= 0) {
                            takeDamage(quest.penalty || 10, `Quest "${quest.title}" scaduta!`);
                            quest.accepted = false;
                            quest.deadline = null;
                            saveGame();
                            updateUI();
                        } else {
                            timerEl.textContent = formatTime(timeLeft);
                        }
                    }
                }
            });
            
            // Update custom quest timers
            (gameState.quests.custom || []).forEach(quest => {
                if (quest.accepted && quest.deadline && !quest.completed) {
                    const timeLeft = quest.deadline - Date.now();
                    const timerEl = document.getElementById(`timer-${quest.id}`);
                    
                    if (timerEl) {
                        if (timeLeft <= 0) {
                            takeDamage(quest.penalty || 10, `Quest "${quest.title}" scaduta!`);
                            quest.accepted = false;
                            quest.deadline = null;
                            saveGame();
                            updateUI();
                        } else {
                            timerEl.textContent = formatTime(timeLeft);
                        }
                    }
                }
            });
            
            // Update emergency quest timer
            if (gameState.quests.emergency && gameState.quests.emergency.deadline) {
                const timeLeft = gameState.quests.emergency.deadline - Date.now();
                const timerEl = document.getElementById(`timer-${gameState.quests.emergency.id}`);
                
                if (timerEl) {
                    if (timeLeft <= 0) {
                        takeDamage(20, "Emergency Quest Fallita!");
                        gameState.quests.emergency = null;
                        saveGame();
                        updateUI();
                    } else {
                        timerEl.textContent = formatTime(timeLeft);
                    }
                }
            }
            
            // Update boss quest timer
            if (gameState.quests.boss && gameState.quests.boss.accepted && gameState.quests.boss.deadline) {
                const timeLeft = gameState.quests.boss.deadline - Date.now();
                const timerEl = document.getElementById(`timer-${gameState.quests.boss.id}`);
                
                if (timerEl) {
                    if (timeLeft <= 0) {
                        takeDamage(gameState.quests.boss.penalty || 30, "Boss Fight Fallita!");
                        gameState.quests.boss.accepted = false;
                        gameState.quests.boss.deadline = null;
                        saveGame();
                        updateUI();
                    } else {
                        timerEl.textContent = formatTime(timeLeft);
                    }
                }
            }
            
            // Update status effect timers
            gameState.player.statusEffects = gameState.player.statusEffects.filter(effect => {
                if (effect.duration) {
                    return effect.duration > Date.now();
                }
                return true;
            });
        }

        function formatTime(ms) {
            const hours = Math.floor(ms / 3600000);
            const minutes = Math.floor((ms % 3600000) / 60000);
            const seconds = Math.floor((ms % 60000) / 1000);
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateShadowArmy(quest) {
            let shadow = gameState.shadowArmy.find(s => s.questTitle === quest.title);
            
            if (shadow) {
                shadow.streak++;
                if (shadow.streak >= 30 && shadow.level < 3) {
                    shadow.level++;
                    showNotification(`üë• Shadow Army Level Up! ${shadow.name} √® ora livello ${shadow.level}!`);
                }
            } else if (quest.completed) {
                gameState.shadowArmy.push({
                    name: quest.title,
                    questTitle: quest.title,
                    level: 1,
                    streak: 1,
                    bonus: calculateShadowBonus(quest)
                });
            }
            
            checkAchievement('shadow_master');
        }

        function breakShadowStreak(quest) {
            const shadow = gameState.shadowArmy.find(s => s.questTitle === quest.title);
            if (shadow) {
                shadow.streak = Math.max(0, shadow.streak - 3);
                if (shadow.streak === 0) {
                    gameState.shadowArmy = gameState.shadowArmy.filter(s => s !== shadow);
                    showNotification(`üë• Shadow persa: ${shadow.name}`);
                }
            }
        }

        function calculateShadowBonus(quest) {
            const baseBonus = Math.floor(quest.reward / 10);
            return `+${baseBonus} ${quest.category || 'general'} auto`;
        }

        function renderSelfComparison() {
            const container = document.getElementById('selfComparison');
            // Count both daily and custom completed quests
            const dailyCompleted = gameState.quests.daily.filter(q => q.completed).length;
            const customCompleted = (gameState.quests.custom || []).filter(q => q.completed).length;
            const todayQuests = dailyCompleted + customCompleted;
            const yesterdayQuests = gameState.history.yesterday.quests || 0;
            
            container.innerHTML = `
                <div class="comparison-box">
                    <div class="comparison-title">‚öîÔ∏è OGGI vs IERI</div>
                    <div class="comparison-row">
                        <div class="comparison-label">Quest Completate</div>
                        <div class="comparison-values">
                            <span class="comparison-old">Ieri: ${yesterdayQuests}</span>
                            <span class="comparison-new ${todayQuests >= yesterdayQuests ? 'winning' : 'losing'}">Oggi: ${todayQuests}</span>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px; font-size: 18px; color: ${todayQuests >= yesterdayQuests ? '#4ecdc4' : '#ff6b6b'};">
                        ${todayQuests > yesterdayQuests ? '‚úÖ DOMINIO TOTALE!' : todayQuests === yesterdayQuests ? '‚öñÔ∏è PAREGGIO' : '‚ö†Ô∏è Stai perdendo! Fai meglio!'}
                    </div>
                </div>
            `;
        }

        function renderShadowArmy() {
            const container = document.getElementById('shadowArmyList');
            
            if (gameState.shadowArmy.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">Completa quest per 30 giorni di fila per ottenere Shadow Army!</div>';
                return;
            }
            
            container.innerHTML = '';
            gameState.shadowArmy.forEach(shadow => {
                const div = document.createElement('div');
                div.className = 'shadow-item';
                div.innerHTML = `
                    <div class="shadow-name">Lv.${shadow.level} ${shadow.name}</div>
                    <div class="shadow-streak">üî• Streak: ${shadow.streak} giorni</div>
                    <div class="shadow-bonus">Bonus: ${shadow.bonus}</div>
                `;
                container.appendChild(div);
            });
        }

        function renderCompletionCalendar() {
            const container = document.getElementById('completionCalendar');
            if (!container) return;
            
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Get first and last day of month
            const firstDay = new Date(currentYear, currentMonth, 1);
            const lastDay = new Date(currentYear, currentMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startDayOfWeek = firstDay.getDay(); // 0 = Sunday
            
            const monthNames = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno',
                              'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
            
            let html = `
                <div style="text-align: center; margin-bottom: 15px;">
                    <h3 style="color: #ffd700; margin: 0;">${monthNames[currentMonth]} ${currentYear}</h3>
                    <p style="color: #bbb; font-size: 12px; margin: 5px 0;">
                        üü¢ = Tutte quest completate | ‚ùå = Quest mancate | ‚ö™ = Nessuna quest
                    </p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; margin-bottom: 6px;">
                    <div style="text-align: center; color: #888; font-size: 10px; padding: 3px;">Dom</div>
                    <div style="text-align: center; color: #888; font-size: 10px; padding: 3px;">Lun</div>
                    <div style="text-align: center; color: #888; font-size: 10px; padding: 3px;">Mar</div>
                    <div style="text-align: center; color: #888; font-size: 10px; padding: 3px;">Mer</div>
                    <div style="text-align: center; color: #888; font-size: 10px; padding: 3px;">Gio</div>
                    <div style="text-align: center; color: #888; font-size: 10px; padding: 3px;">Ven</div>
                    <div style="text-align: center; color: #888; font-size: 10px; padding: 3px;">Sab</div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px;">
            `;
            
            // Add empty cells for days before month starts
            for (let i = 0; i < startDayOfWeek; i++) {
                html += '<div style="padding: 10px;"></div>';
            }
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dateISO = date.toISOString().split('T')[0];
                const isToday = day === now.getDate();
                const isFuture = date > now;
                
                let emoji = '‚ö™';
                let bgColor = 'rgba(100,100,100,0.1)';
                let borderColor = 'rgba(100,100,100,0.3)';
                
                if (!isFuture && gameState.completionCalendar && gameState.completionCalendar[dateISO]) {
                    const dayData = gameState.completionCalendar[dateISO];
                    if (dayData.completed) {
                        emoji = 'üü¢';
                        bgColor = 'rgba(34, 197, 94, 0.2)';
                        borderColor = 'rgba(34, 197, 94, 0.5)';
                    } else if (dayData.total > 0) {
                        emoji = '‚ùå';
                        bgColor = 'rgba(239, 68, 68, 0.2)';
                        borderColor = 'rgba(239, 68, 68, 0.5)';
                    }
                }
                
                const todayBorder = isToday ? 'border: 2px solid #ffd700;' : `border: 1px solid ${borderColor};`;
                
                html += `
                    <div style="
                        background: ${bgColor};
                        ${todayBorder}
                        border-radius: 6px;
                        padding: 4px 2px;
                        text-align: center;
                        min-height: 38px;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        justify-content: center;
                        ${isFuture ? 'opacity: 0.3;' : ''}
                    ">
                        <div style="font-size: 10px; color: #bbb; margin-bottom: 1px;">${day}</div>
                        <div style="font-size: 13px;">${emoji}</div>
                    </div>
                `;
            }
            
            html += '</div>';
            
            // Add statistics
            if (!gameState.completionCalendar) gameState.completionCalendar = {};
            const completedDays = Object.values(gameState.completionCalendar).filter(d => d.completed).length;
            const totalTracked = Object.keys(gameState.completionCalendar).length;
            const completionRate = totalTracked > 0 ? Math.round((completedDays / totalTracked) * 100) : 0;
            
            html += `
                <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; text-align: center;">
                    <div style="color: #ffd700; font-weight: bold; margin-bottom: 5px;">üìä Statistiche</div>
                    <div style="color: #bbb; font-size: 13px;">
                        Giorni perfetti: ${completedDays} / ${totalTracked} 
                        ${totalTracked > 0 ? `(${completionRate}%)` : ''}
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function checkAchievements() {
            // Iron Will
            const longestStreak = Math.max(...(gameState.shadowArmy.map(s => s.streak) || [0]));
            if (longestStreak >= 30) checkAchievement('iron_will');
            
            // Shadow Master
            if (gameState.shadowArmy.length >= 10) checkAchievement('shadow_master');
            
            // Count quest types
            const physicalCount = gameState.shadowArmy.filter(s => s.bonus.includes('physical')).length;
            const intellectualCount = gameState.shadowArmy.filter(s => s.bonus.includes('intelligence')).length;
            
            if (physicalCount >= 100) checkAchievement('warrior');
            if (intellectualCount >= 100) checkAchievement('scholar');
        }

        function checkAchievement(achievementId) {
            const achievement = gameState.achievements.find(a => a.id === achievementId);
            if (achievement && !achievement.unlocked) {
                achievement.unlocked = true;
                showNotification(`üèÜ Achievement Sbloccato: ${achievement.title}!`);
                applyAchievementBonus(achievement);
                saveGame();
                updateUI();
            }
        }

        function applyAchievementBonus(achievement) {
            switch(achievement.id) {
                case 'iron_will':
                    gameState.player.maxHP += 10;
                    gameState.player.hp += 10;
                    break;
                case 'shadow_master':
                    gameState.player.maxMP += 20;
                    gameState.player.mp += 20;
                    break;
                case 'scholar':
                    gameState.player.stats.int += 15;
                    break;
                case 'warrior':
                    gameState.player.stats.str += 15;
                    break;
                case 'emergency_hero':
                    gameState.player.maxHP += 100;
                    gameState.player.hp += 100;
                    break;
            }
        }

        function renderAchievements() {
            const container = document.getElementById('achievementsList');
            container.innerHTML = '';
            
            gameState.achievements.forEach(achievement => {
                const div = document.createElement('div');
                div.className = `achievement-item ${achievement.unlocked ? 'unlocked' : ''}`;
                div.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-title">${achievement.title}</div>
                    <div class="achievement-desc">${achievement.desc}</div>
                `;
                div.onclick = () => {
                    if (achievement.unlocked) {
                        const setActive = confirm(`Vuoi impostare "${achievement.title}" come titolo attivo?\nBonus: ${achievement.bonus}`);
                        if (setActive) {
                            gameState.player.activeTitle = achievement.id;
                            saveGame();
                            updateUI();
                        }
                    }
                };
                container.appendChild(div);
            });
        }

        function renderSkillTree() {
            const container = document.getElementById('skillTree');
            container.innerHTML = '';
            
            ['combat', 'magic', 'support'].forEach(branch => {
                const branchDiv = document.createElement('div');
                branchDiv.className = 'skill-branch';
                
                const titles = { combat: '‚öîÔ∏è Combat', magic: '‚ú® Magic', support: 'üõ°Ô∏è Support' };
                branchDiv.innerHTML = `<div class="skill-branch-title">${titles[branch]}</div><div class="skill-list" id="${branch}-skills"></div>`;
                
                container.appendChild(branchDiv);
                
                const skillList = document.getElementById(`${branch}-skills`);
                gameState.skills[branch].forEach(skill => {
                    const canUnlock = !skill.requires || gameState.skills[branch].find(s => s.id === skill.requires)?.unlocked;
                    const isLocked = !skill.unlocked && (!canUnlock || gameState.player.skillPoints < skill.cost);
                    
                    const div = document.createElement('div');
                    div.className = `skill-item ${skill.unlocked ? 'unlocked' : ''} ${isLocked ? 'locked' : ''}`;
                    div.innerHTML = `
                        <div class="skill-name">${skill.name} ${skill.unlocked ? '‚úÖ' : ''}</div>
                        <div class="skill-desc">${skill.desc}</div>
                        <div class="skill-cost">Costo: ${skill.cost} SP ${skill.requires ? `| Richiede: ${skill.requires}` : ''}</div>
                    `;
                    
                    div.onclick = () => {
                        if (!skill.unlocked && canUnlock && gameState.player.skillPoints >= skill.cost) {
                            const confirm = window.confirm(`Sbloccare ${skill.name} per ${skill.cost} Skill Points?`);
                            if (confirm) {
                                skill.unlocked = true;
                                gameState.player.skillPoints -= skill.cost;
                                showNotification(`‚ú® Skill Sbloccata: ${skill.name}!`);
                                saveGame();
                                updateUI();
                            }
                        }
                    };
                    
                    skillList.appendChild(div);
                });
            });
        }

        function renderInventory() {
            const grid = document.getElementById('inventoryGrid');
            
            if (gameState.inventory.items.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; color: #999; padding: 40px;">
                        Nessun oggetto nell'inventario.
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = '';
            gameState.inventory.items.forEach((item, index) => {
                const slot = document.createElement('div');
                slot.className = `inventory-slot ${item.effect ? 'has-effect' : ''}`;
                slot.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div style="font-size: 10px; text-align: center; margin-top: 5px;">${item.name}</div>
                    <div class="item-count">x${item.quantity}</div>
                    ${item.effect ? `<div class="item-effect">‚ú®</div>` : ''}
                `;
                slot.onclick = () => showItemOptions(index);
                grid.appendChild(slot);
            });
        }

        function applyItemEffects() {
            // Apply passive effects from items
            gameState.inventory.items.forEach(item => {
                if (item.effect === 'hp_regen') {
                    // Check if already applied today
                    if (!item.lastRegenDate || item.lastRegenDate !== new Date().toDateString()) {
                        gameState.player.hp = Math.min(gameState.player.maxHP, gameState.player.hp + 5);
                        item.lastRegenDate = new Date().toDateString();
                    }
                }
                if (item.effect === 'mp_regen') {
                    if (!item.lastRegenDate || item.lastRegenDate !== new Date().toDateString()) {
                        gameState.player.mp = Math.min(gameState.player.maxMP, gameState.player.mp + 3);
                        item.lastRegenDate = new Date().toDateString();
                    }
                }
            });
        }

        function showAddItemModal() {
            document.getElementById('addItemModal').classList.add('show');
            document.getElementById('itemIcon').value = 'üì¶';
            document.getElementById('itemName').value = '';
            document.getElementById('itemQuantity').value = '1';
            document.getElementById('itemEffect').value = '';
        }

        function closeAddItemModal() {
            document.getElementById('addItemModal').classList.remove('show');
        }

        function addItemToInventory() {
            const icon = document.getElementById('itemIcon').value || 'üì¶';
            const name = document.getElementById('itemName').value.trim();
            const quantity = parseInt(document.getElementById('itemQuantity').value) || 1;
            const effect = document.getElementById('itemEffect').value;
            
            if (!name) {
                showNotification('‚ö†Ô∏è Inserisci un nome per l\'oggetto!');
                return;
            }
            
            const existingItem = gameState.inventory.items.find(item => item.name === name);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                gameState.inventory.items.push({
                    icon, name, quantity, effect: effect || null
                });
            }
            
            saveGame();
            updateUI();
            closeAddItemModal();
            showNotification(`‚úÖ ${icon} ${name} aggiunto all'inventario!`);
        }

        function showItemOptions(index) {
            const item = gameState.inventory.items[index];
            const effectText = item.effect ? `\nEffetto: ${item.effect}` : '';
            const action = confirm(`${item.icon} ${item.name} (x${item.quantity})${effectText}\n\nVuoi rimuovere questo oggetto?`);
            
            if (action) {
                gameState.inventory.items.splice(index, 1);
                saveGame();
                updateUI();
                showNotification('üóëÔ∏è Oggetto rimosso dall\'inventario');
            }
        }

        function renderCrafting() {
            const grid = document.getElementById('craftingGrid');
            grid.innerHTML = '';
            
            craftingRecipes.forEach(recipe => {
                if (!recipe.unlocked) {
                    const masterCrafter = gameState.skills.support?.find(s => s.id === 'master_crafter' && s.unlocked);
                    if (!masterCrafter) return;
                    recipe.unlocked = true;
                }
                
                const canCraft = recipe.materials.every(mat => {
                    if (mat.name === 'Mana Stones') {
                        return gameState.inventory.manaStones >= mat.count;
                    }
                    const item = gameState.inventory.items.find(i => i.name === mat.name);
                    return item && item.quantity >= mat.count;
                });
                
                const div = document.createElement('div');
                div.className = `recipe-item ${recipe.unlocked ? 'unlocked' : ''}`;
                div.innerHTML = `
                    <div class="recipe-name">${recipe.name}</div>
                    <div class="recipe-materials">
                        ${recipe.materials.map(m => `${m.name} x${m.count}`).join(', ')}
                    </div>
                    <button class="craft-btn" ${canCraft ? '' : 'disabled'} onclick="craft('${recipe.id}')">
                        Craft
                    </button>
                `;
                grid.appendChild(div);
            });
        }

        function craft(recipeId) {
            const recipe = craftingRecipes.find(r => r.id === recipeId);
            if (!recipe) return;
            
            // Check materials
            const canCraft = recipe.materials.every(mat => {
                if (mat.name === 'Mana Stones') {
                    return gameState.inventory.manaStones >= mat.count;
                }
                const item = gameState.inventory.items.find(i => i.name === mat.name);
                return item && item.quantity >= mat.count;
            });
            
            if (!canCraft) {
                showNotification('‚ö†Ô∏è Materiali insufficienti!');
                return;
            }
            
            // Consume materials
            recipe.materials.forEach(mat => {
                if (mat.name === 'Mana Stones') {
                    gameState.inventory.manaStones -= mat.count;
                } else {
                    const item = gameState.inventory.items.find(i => i.name === mat.name);
                    item.quantity -= mat.count;
                    if (item.quantity <= 0) {
                        gameState.inventory.items = gameState.inventory.items.filter(i => i !== item);
                    }
                }
            });
            
            // Apply result
            if (recipe.result.type === 'consumable') {
                if (recipe.result.effect === 'restore_hp') {
                    gameState.player.hp = Math.min(gameState.player.maxHP, gameState.player.hp + recipe.result.value);
                    showNotification(`‚úÖ Craftato! +${recipe.result.value} HP`);
                }
            } else if (recipe.result.type === 'buff') {
                gameState.player.statusEffects.push({
                    name: recipe.name,
                    type: 'buff',
                    effect: recipe.result.effect,
                    value: recipe.result.value,
                    duration: Date.now() + recipe.result.duration
                });
                showNotification(`‚úÖ Craftato! ${recipe.name} attivo!`);
            }
            
            saveGame();
            updateUI();
        }

        function showCreateQuestModal() {
            document.getElementById('createQuestModal').classList.add('show');
            document.getElementById('customQuestTitle').value = '';
            document.getElementById('customQuestDesc').value = '';
            document.getElementById('customQuestDifficulty').value = 'medium';
        }

        function toggleRecurrenceOptions() {
            const isRecurring = document.querySelector('input[name="recurrence"]:checked').value === 'recurring';
            document.getElementById('recurrenceOptions').style.display = isRecurring ? 'block' : 'none';
            if (isRecurring) {
                toggleDaySelector(); // Check if specific days is selected
            }
        }

        function toggleDaySelector() {
            const isSpecific = document.querySelector('input[name="recurrenceType"][value="specific"]')?.checked;
            document.getElementById('daySelector').style.display = isSpecific ? 'block' : 'none';
        }

        // Add listeners for recurrence type radio buttons
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input[name="recurrenceType"]').forEach(radio => {
                radio.addEventListener('change', toggleDaySelector);
            });
        });

        function closeCreateQuestModal() {
            document.getElementById('createQuestModal').classList.remove('show');
        }

        function createCustomQuest() {
            const title = document.getElementById('customQuestTitle').value.trim();
            const desc = document.getElementById('customQuestDesc').value.trim();
            const difficulty = document.getElementById('customQuestDifficulty').value;
            
            if (!title || !desc) {
                showNotification('‚ö†Ô∏è Compila tutti i campi!');
                return;
            }
            
            const rewardMap = {
                easy: 30 + Math.floor(Math.random() * 10),
                medium: 50 + Math.floor(Math.random() * 20),
                hard: 80 + Math.floor(Math.random() * 20),
                extreme: 120 + Math.floor(Math.random() * 30)
            };
            
            const reward = rewardMap[difficulty];
            const penalty = Math.floor(reward / 5);
            
            // Get recurrence settings
            const isRecurring = document.querySelector('input[name="recurrence"]:checked').value === 'recurring';
            let recurrence = null;
            
            if (isRecurring) {
                const recurrenceType = document.querySelector('input[name="recurrenceType"]:checked').value;
                
                if (recurrenceType === 'daily') {
                    recurrence = { type: 'daily' };
                } else if (recurrenceType === 'weekdays') {
                    recurrence = { type: 'weekdays', days: [1, 2, 3, 4, 5] };
                } else if (recurrenceType === 'weekend') {
                    recurrence = { type: 'weekend', days: [0, 6] };
                } else if (recurrenceType === 'specific') {
                    const selectedDays = Array.from(document.querySelectorAll('.day-checkbox:checked'))
                        .map(cb => parseInt(cb.value));
                    
                    if (selectedDays.length === 0) {
                        showNotification('‚ö†Ô∏è Seleziona almeno un giorno!');
                        return;
                    }
                    
                    recurrence = { type: 'specific', days: selectedDays };
                }
            }
            
            if (!gameState.quests.custom) gameState.quests.custom = [];
            
            const quest = {
                id: Date.now(),
                title,
                description: desc,
                reward,
                penalty,
                completed: false,
                type: 'custom',
                category: 'productivity'
            };
            
            if (recurrence) {
                quest.recurring = true;
                quest.recurrence = recurrence;
                quest.completionHistory = []; // Track quando √® stata completata
            }
            
            gameState.quests.custom.push(quest);
            
            saveGame();
            updateUI();
            closeCreateQuestModal();
            
            const recurrenceText = recurrence ? 
                (recurrence.type === 'daily' ? ' (ogni giorno)' : 
                 recurrence.type === 'weekdays' ? ' (Lun-Ven)' :
                 recurrence.type === 'weekend' ? ' (Sab-Dom)' :
                 ' (giorni selezionati)') : '';
            
            showNotification(`‚úÖ Quest creata${recurrenceText}! Reward: ${reward} EXP`);
        }

        function drawRadarChart() {
            const canvas = document.getElementById('radarChart');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 120;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const stats = [
                { label: 'Fisico', value: gameState.player.radarStats.physical },
                { label: 'Intel', value: gameState.player.radarStats.intelligence },
                { label: 'Salute', value: gameState.player.radarStats.health },
                { label: 'Sociale', value: gameState.player.radarStats.social },
                { label: 'Produttivit√†', value: gameState.player.radarStats.productivity },
                { label: 'Creativit√†', value: gameState.player.radarStats.creativity }
            ];
            
            const angleStep = (Math.PI * 2) / stats.length;
            
            // Draw grid
            ctx.strokeStyle = 'rgba(106, 90, 205, 0.3)';
            ctx.lineWidth = 1;
            for (let i = 1; i <= 5; i++) {
                ctx.beginPath();
                const r = (radius / 5) * i;
                for (let j = 0; j <= stats.length; j++) {
                    const angle = angleStep * j - Math.PI / 2;
                    const x = centerX + Math.cos(angle) * r;
                    const y = centerY + Math.sin(angle) * r;
                    if (j === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = 'rgba(106, 90, 205, 0.5)';
            stats.forEach((stat, i) => {
                const angle = angleStep * i - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // Draw labels
                const labelX = centerX + Math.cos(angle) * (radius + 20);
                const labelY = centerY + Math.sin(angle) * (radius + 20);
                ctx.fillStyle = '#ffd700';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(stat.label, labelX, labelY);
            });
            
            // Draw data
            ctx.fillStyle = 'rgba(138, 43, 226, 0.3)';
            ctx.strokeStyle = 'rgba(138, 43, 226, 0.8)';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            stats.forEach((stat, i) => {
                const angle = angleStep * i - Math.PI / 2;
                const value = (stat.value / 100) * radius;
                const x = centerX + Math.cos(angle) * value;
                const y = centerY + Math.sin(angle) * value;
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        function showNotification(message, persistent = false, isEmergency = false) {
            const notif = document.getElementById('notification');
            notif.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
                    <div style="flex: 1;">${message}</div>
                    <button onclick="closeNotification()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">‚úï</button>
                </div>
            `;
            notif.classList.remove('emergency');
            
            if (isEmergency) {
                notif.classList.add('emergency');
            }
            
            notif.classList.add('show');
            
            if (!persistent) {
                setTimeout(() => {
                    notif.classList.remove('show');
                }, 3000);
            }
        }

        function closeNotification() {
            const notif = document.getElementById('notification');
            notif.classList.remove('show');
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }

        function sendPushNotification(title, body) {
            if (!gameState.notificationsEnabled) return;
            
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(title, {
                    body: body,
                    icon: '‚öîÔ∏è',
                    badge: '‚öîÔ∏è'
                });
            }
        }

        function toggleNotifications() {
            gameState.notificationsEnabled = document.getElementById('notificationsEnabled').checked;
            
            if (gameState.notificationsEnabled && 'Notification' in window) {
                if (Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission !== 'granted') {
                            gameState.notificationsEnabled = false;
                            document.getElementById('notificationsEnabled').checked = false;
                            showNotification('‚ö†Ô∏è Permesso notifiche negato!');
                        }
                    });
                } else if (Notification.permission === 'denied') {
                    gameState.notificationsEnabled = false;
                    document.getElementById('notificationsEnabled').checked = false;
                    showNotification('‚ö†Ô∏è Permesso notifiche negato! Abilitale nelle impostazioni del browser.');
                }
            }
            
            saveGame();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById('tab-' + tab).classList.add('active');
            
            const navButtons = document.querySelectorAll('.nav-btn');
            const buttonIndex = {'player': 0, 'quests': 1, 'progress': 2, 'inventory': 3, 'settings': 4};
            if (buttonIndex[tab] !== undefined) {
                navButtons[buttonIndex[tab]].classList.add('active');
            }
        }

        function saveProfession() {
            const profession = document.getElementById('professionInput').value.trim();
            gameState.player.profession = profession || 'none';
            gameState.quests.daily = generateDailyQuests();
            saveGame();
            updateUI();
            showNotification('‚úÖ Professione aggiornata! Le quest sono state rigenerate.');
        }

        function saveName() {
            const name = document.getElementById('nameInput').value.trim();
            if (name) {
                gameState.player.name = name;
                saveGame();
                updateUI();
                showNotification('‚úÖ Nome salvato!');
            }
        }

        function resetProgress() {
            if (confirm('Sei sicuro di voler resettare tutto il progresso?')) {
                localStorage.removeItem('realLifeLevelingComplete');
                location.reload();
            }
        }
    </script>
</body>
</html>
